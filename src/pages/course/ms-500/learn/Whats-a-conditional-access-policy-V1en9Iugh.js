import * as React from "react"
import Page from '../../../../components/page'
import Container from 'react-bootstrap/Container'
import Row from 'react-bootstrap/Row'
import Col from 'react-bootstrap/Col'
import Accordion from 'react-bootstrap/Accordion'
import ListGroup from 'react-bootstrap/ListGroup'
import Form from 'react-bootstrap/Form'
import { Link } from "gatsby"
import {getDoc, getAllDocs, saveDoc, onAuthStateChanged} from '../../../../components/firebase'
import draftToHtml from 'draftjs-to-html'
import { IoChevronBack, IoChevronForward } from "react-icons/io5";
 
const isBrowser = () => typeof window !== 'undefined'

const removePaddingStyle = {
  padding: '0px'
}

const marginTop24Style = {
  marginTop: '24px'
}

const listItemStyle = {
  border: 'none',
  paddingTop: '12px',
  paddingBottom: '12px'
}

const sort = (course, articles) => {
  return articles.sort((a, b) => {
    return course.contentOrder.indexOf(a.id) - course.contentOrder.indexOf(b.id)
  })
}

class ArticlePage extends React.Component {
  constructor(props) {
    super(props)
    this.trackScrolling = this.trackScrolling.bind(this)
    this.setHasCompletedContent = this.setHasCompletedContent.bind(this)

    let currentSlug = props.location.pathname.replace('/course/ms-500/learn/', '').split('/')[0]
    if (currentSlug === 'article')
      currentSlug = 'Securing-and-implementing-enterprise-applications-2QfoI2HxY'

    this.state = {
      currentSlug: currentSlug,
      isTrackScrolling: false,
      course: {"contentOrder":["cpchjBLkC","KKkBOVuS4","bzotoOjEe","cg_vxOX9L","uYCIPbnMC","7CpqFkPZU","rZzausKJ1","ky5W0Lz5P","i9pJIjTNH","S1hQgFOMV","2QfoI2HxY","V1en9Iugh","nAAIvNbtk","2S9jn0aLr","FldNualGC","NFQ6rYFeQ","rK48f6iM2","RHW1API2s","z8EMM9Eu_","Kye_yNLxA","EnPyp7ukN","6HUOr7qbL","GCOOUsSBT","GG4cMY8pK","z0qPG6v4T","LEyZMWBSt","7MQ3wE4wP","sH_Ee1DW1","vLweLmxZf","NsF7No40f","IsPGsme8w","wv2PbXnhI","7gR3L122b","ZyKX3Idjs","MAjW0a2_p","XFXu2zIS9","_LL9VqGZO","qDRA4jjoN","62t_7oiZx"],"audience":"Anyone who wants to learn about securing Microsoft 365","title":"Training for MS-500: Microsoft Office 365 Security Admin","sections":[{"title":"Introduction","order":0,"id":"qwJW5VrBW"},{"order":1,"id":"AFV_acckJ","title":"Securing identity and access to Microsoft 365"},{"id":"QScYfSu74","order":2,"title":"Securing Microsoft 365, clouds, and on-premises environments"},{"id":"YhftdGIRX","order":3,"title":"Protecting your environment from accidental and malicious data loss"},{"title":"Protecting User devices using Intune","order":4,"id":"l0DxUuonW"}],"id":"MS-500","description":"Learn, prepare and training for the Microsoft Microsoft Office 365 Exam MS-500: Microsoft 365 Security Administration MS-500 exam"},
      article: {"type":"article","images":["https://i.ibb.co/DQm1sY0/Create-conditional-access-policy.png","https://i.ibb.co/G7QBxPT/name-your-conditional-access-policy.png","https://i.ibb.co/ZBhyf3h/set-conditional-access-policy-to-apply-to-admins.png","https://i.ibb.co/K9J1dVJ/conditional-access-policy-set-all-cloud-apps.png","https://i.ibb.co/PTQmjND/conditional-access-policy-require-mfa.png","https://i.ibb.co/bJPCQ7w/conditional-access-warning.png","https://i.ibb.co/5rJVTmz/conditional-access-policy-users-or-workload-identities.png","https://i.ibb.co/X7XTxRK/Conditional-access-policy-cloud-apps-or-actions.png","https://i.ibb.co/Yypqyqs/conditional-access-policy-conditions.png","https://i.ibb.co/K5PZLY8/conditional-access-policy-grant.png","https://i.ibb.co/jDj8CpP/conditional-access-policy-session.png","https://i.ibb.co/SBvR7ry/conditional-access-policy-logs.png","https://i.ibb.co/G54Sy34/conditional-access-policy-new-named-location.png","https://i.ibb.co/nshF1qX/conditional-access-policy-named-location-by-ip-address.png","https://i.ibb.co/zb3v6Nm/conditional-access-policy-exclude-location.png"],"featuredImage":"https://i.ibb.co/DQm1sY0/Create-conditional-access-policy.png","description":"Conditional access policies help organizations improve security and compliance. They are used to fine-tune and customize the authentication of your users in Microsoft 365. Let me explain. In the simplest terms, it’s a series of if statements.","title":"What's a conditional access policy?","article":{"blocks":[{"inlineStyleRanges":[],"key":"8ikeh","data":{},"text":"Conditional access policies help organizations improve security and compliance. They are used to fine-tune and customize the authentication of your users in Microsoft 365. Let me explain. ","entityRanges":[],"depth":0,"type":"unstyled"},{"data":{},"text":"In the simplest terms, it’s a series of if statements. For example, you can create a conditional access policy to require all members of a particular group to use Multi-Factor Authentication to log in to Microsoft 365. “If the user is part of group X then require MFA”.","type":"unstyled","key":"6tcip","depth":0,"inlineStyleRanges":[],"entityRanges":[]},{"text":"You can set a lot of different options in conditional access policies. For example, you can create a policy so a certain set of users can only log in from specific IP addresses. “If the user is part of group X and not logging in from IP address 1.1.1.1 then block access”","data":{},"depth":0,"key":"6p02s","inlineStyleRanges":[],"type":"unstyled","entityRanges":[]},{"inlineStyleRanges":[],"entityRanges":[],"type":"header-two","depth":0,"key":"1n69g","text":"License Requirements","data":{}},{"key":"elnuf","text":"You’re required to have an Azure AD Premium P1, Azure AD Premium P2 license, or Microsoft 365 Business Premium license. The Conditional access policies are also included in the following licenses:","depth":0,"inlineStyleRanges":[],"type":"unstyled","entityRanges":[],"data":{}},{"data":{},"depth":0,"key":"e54sf","text":"Microsoft 365 E3 & E5","entityRanges":[],"inlineStyleRanges":[],"type":"unordered-list-item"},{"key":"2dbae","depth":0,"data":{},"text":"Microsoft 365 F3","entityRanges":[],"inlineStyleRanges":[],"type":"unordered-list-item"},{"entityRanges":[],"depth":0,"data":{},"type":"unordered-list-item","inlineStyleRanges":[],"key":"5uish","text":"Enterprise Mobility + Security E3 (EMS E3), and E5 (EMS E5)"},{"key":"6pl7d","type":"header-two","inlineStyleRanges":[],"depth":0,"data":{},"entityRanges":[],"text":"Creating your first conditional access policy"},{"inlineStyleRanges":[],"data":{},"type":"unstyled","depth":0,"text":"Let’s create a conditional access policy that requires all our admins to use MFA to sign in to Microsoft 365.","key":"ed03u","entityRanges":[]},{"inlineStyleRanges":[],"text":"1. log in to Azure Active Directory admin center > All services > Azure AD Conditional Access > New Policy > Create new policy.","entityRanges":[{"length":17,"offset":109,"key":0}],"depth":0,"key":"2gr0m","type":"unstyled","data":{}},{"data":{},"key":"82alu","type":"atomic","text":" ","depth":0,"inlineStyleRanges":[],"entityRanges":[{"key":1,"offset":0,"length":1}]},{"entityRanges":[],"key":"9gtfv","data":{},"text":"2. Set the name to “Require MFA for admins”.","inlineStyleRanges":[{"length":5,"style":"BOLD","offset":11}],"depth":0,"type":"unstyled"},{"depth":0,"entityRanges":[{"key":2,"offset":0,"length":1}],"data":{},"inlineStyleRanges":[],"key":"7sevv","text":" ","type":"atomic"},{"entityRanges":[],"key":"8vdjb","inlineStyleRanges":[{"offset":9,"style":"BOLD","length":39},{"length":23,"style":"BOLD","offset":56},{"style":"BOLD","offset":82,"length":15}],"depth":0,"type":"unstyled","data":{},"text":"3. Click 0 users or workload identities selected. Click Select users and groups > Directory roles. Then click each role that has administrator in its name."},{"key":"7uj17","text":" ","entityRanges":[{"key":3,"length":1,"offset":0}],"data":{},"type":"atomic","inlineStyleRanges":[],"depth":0},{"key":"8v58r","type":"unstyled","depth":0,"data":{},"text":"4. Click No cloud apps, actions, or authentication contexts selected. Click All cloud apps.","inlineStyleRanges":[{"style":"BOLD","length":59,"offset":9},{"length":14,"offset":76,"style":"BOLD"}],"entityRanges":[]},{"key":"7oall","depth":0,"entityRanges":[{"key":4,"offset":0,"length":1}],"data":{},"inlineStyleRanges":[],"text":" ","type":"atomic"},{"inlineStyleRanges":[{"style":"BOLD","length":20,"offset":8},{"style":"BOLD","offset":48,"length":35},{"length":6,"offset":91,"style":"BOLD"},{"length":2,"offset":105,"style":"BOLD"}],"text":"5. Click 0 controls selected under Grant. Click Require multi-factor authentication. Click Select. Click On under Enable policy.","entityRanges":[],"depth":0,"data":{},"key":"8epph","type":"unstyled"},{"inlineStyleRanges":[],"key":"dtguk","data":{},"text":" ","entityRanges":[{"key":5,"length":1,"offset":0}],"depth":0,"type":"atomic"},{"inlineStyleRanges":[],"entityRanges":[],"depth":0,"text":"6. At this point you may see a warning say “Don’t lock yourself out!”. Read the recommendation carefully and then make your decision whether to exclude yourself from the policy.","type":"unstyled","data":{},"key":"90a5c"},{"key":"5ggfr","data":{},"entityRanges":[{"offset":0,"key":6,"length":1}],"type":"atomic","inlineStyleRanges":[],"text":" ","depth":0},{"data":{},"type":"unstyled","key":"dci6q","depth":0,"text":"7. Click Create.","entityRanges":[],"inlineStyleRanges":[{"offset":9,"length":6,"style":"BOLD"}]},{"data":{},"text":"That’s it. You are now requiring your administrators to configure and use MFA when they log in to Office 365. Now let’s break down the parts of the conditional access policy configuration.","key":"3ivov","depth":0,"type":"unstyled","entityRanges":[],"inlineStyleRanges":[]},{"key":"2kn73","depth":0,"type":"header-two","inlineStyleRanges":[],"text":"Understanding conditional access policies","entityRanges":[],"data":{}},{"data":{},"type":"unstyled","entityRanges":[],"depth":0,"key":"f0a1i","inlineStyleRanges":[],"text":"The conditional access policy is broken into two sections: assignments and Access controls."},{"type":"unstyled","text":"The assignments section is the filters. This is where you can decide which users, device OS’s, and apps the policy affects.","inlineStyleRanges":[],"key":"1i4at","entityRanges":[],"depth":0,"data":{}},{"type":"unstyled","entityRanges":[],"inlineStyleRanges":[],"key":"9q3e1","data":{},"text":"The Access controls section provides your allowed / block controls. It’s also where you can decide things like “require MFA” or block persistent browser sessions.","depth":0},{"entityRanges":[],"type":"header-three","inlineStyleRanges":[],"key":"3f1u1","depth":0,"data":{},"text":"User or workload identities"},{"text":" ","key":"7ge57","data":{},"entityRanges":[{"length":1,"key":7,"offset":0}],"depth":0,"type":"atomic","inlineStyleRanges":[]},{"inlineStyleRanges":[],"key":"d19q8","data":{},"type":"unstyled","depth":0,"entityRanges":[],"text":"In this section, you’re deciding which user accounts will be affected by the policy. You can set up a specific list of users, for example, yourself to test out a policy. You can select a group that would include everyone in the group or you can select admin roles to affect only users that are assigned the specific admin role. Lastly, you can exclude users. So you can create a policy to include All users, then you can exclude guest and external users."},{"data":{},"depth":0,"inlineStyleRanges":[{"offset":0,"style":"ITALIC","length":146}],"entityRanges":[],"type":"unstyled","key":"9sgru","text":"Remember, the exclusion will take precedence. So if you select to include a user then exclude the user, the user will be excluded from the policy."},{"key":"4fn4o","data":{},"inlineStyleRanges":[],"text":"Cloud apps or actions","entityRanges":[],"depth":0,"type":"header-three"},{"inlineStyleRanges":[],"text":" ","key":"1bfii","data":{},"type":"atomic","entityRanges":[{"key":8,"offset":0,"length":1}],"depth":0},{"type":"unstyled","key":"1vms3","inlineStyleRanges":[],"entityRanges":[],"depth":0,"text":"The cloud apps or actions section is where you can filter the conditional access policy based on the app. For example, you may need to require MFA for email access but all other access doesn’t require MFA. If you only wanted the policy to affect email then you would click Select apps > Office 365 Exchange Online.","data":{}},{"text":"Conditions","key":"2dufg","type":"header-three","data":{},"entityRanges":[],"depth":0,"inlineStyleRanges":[]},{"data":{},"type":"atomic","depth":0,"inlineStyleRanges":[],"entityRanges":[{"length":1,"key":9,"offset":0}],"text":" ","key":"4ecdt"},{"key":"2c1s7","text":"Conditions provide an additional layer of filtering. From here you can select if the policy only affects the users when certain other criteria is met. For example, you may want to require MFA only when there’s a high User / sign-in risk. Or you may want to block access altogether from certain countries. Or maybe there are no Android devices in your organization. You can easily select Android devices from this page.","depth":0,"data":{},"type":"unstyled","entityRanges":[],"inlineStyleRanges":[]},{"inlineStyleRanges":[],"key":"fqam3","depth":0,"entityRanges":[],"text":"Access Controls: Grant","data":{},"type":"header-three"},{"key":"9n8io","text":" ","type":"atomic","depth":0,"data":{},"entityRanges":[{"offset":0,"length":1,"key":10}],"inlineStyleRanges":[]},{"entityRanges":[],"key":"fua8a","inlineStyleRanges":[],"depth":0,"text":"From the access controls > grant section you can decide what happens when the criteria above is met. For example, you may want to block access. Or you may want to require multi-factor authentication. Or you may want to require the device to be marked compliant in Intune. It’s all possible in the conditional access policies.","data":{},"type":"unstyled"},{"key":"64rjg","depth":0,"inlineStyleRanges":[],"type":"header-three","data":{},"text":"Access Controls: Session","entityRanges":[]},{"entityRanges":[{"key":11,"offset":0,"length":1}],"key":"45gpv","type":"atomic","data":{},"depth":0,"inlineStyleRanges":[],"text":" "},{"depth":0,"text":"Finally, the session controls. From the session tab, you can set if the user can save their browser session or if they have to sign in again after closing the browser. Or you can set how often users need to re-authenticate when using apps like Outlook or Microsoft Teams.","type":"unstyled","entityRanges":[],"data":{},"inlineStyleRanges":[],"key":"appfe"},{"depth":0,"inlineStyleRanges":[],"key":"675pq","entityRanges":[],"text":"Review the status of conditional access policies","type":"header-two","data":{}},{"type":"unstyled","inlineStyleRanges":[],"data":{},"entityRanges":[],"text":"So, you may be wondering, if I create a policy that blocks sign-ins from non-compliant devices how can I view who’s getting blocked? Fortunately, Microsoft has made it easy.","depth":0,"key":"2sav0"},{"key":"6q6de","type":"unstyled","depth":0,"data":{},"text":"1. Sign in to Azure Active Directory admin center > Users > Sign in logs > click the sign-in you want to investigate > Conditional access.","entityRanges":[],"inlineStyleRanges":[{"style":"BOLD","offset":14,"length":35},{"length":6,"offset":52,"style":"BOLD"},{"style":"BOLD","length":12,"offset":60},{"length":18,"offset":119,"style":"BOLD"}]},{"entityRanges":[{"key":12,"length":1,"offset":0}],"inlineStyleRanges":[],"data":{},"key":"cevv7","type":"atomic","depth":0,"text":" "},{"type":"unstyled","text":"From this page you can see all the conditional access policies, whether they were applied to the sign in and whether the attempt passed or failed. To see more information on the conditional access policy click on it.","inlineStyleRanges":[],"entityRanges":[],"data":{},"key":"9k0gr","depth":0},{"type":"header-two","text":"Force multi-factor authentication while not in the main office","key":"8lo6r","inlineStyleRanges":[],"entityRanges":[],"depth":0,"data":{}},{"key":"435i1","type":"unstyled","depth":0,"data":{},"entityRanges":[],"inlineStyleRanges":[],"text":"Now, let’s get a little trickier. Let’s say the MFA prompt every time a user logs on is too much for your organization. Maybe you only want to prompt for MFA when users are not in your main office. How do you do it?"},{"inlineStyleRanges":[{"offset":14,"length":35,"style":"BOLD"},{"style":"BOLD","offset":52,"length":12},{"style":"BOLD","offset":67,"length":27},{"length":15,"offset":97,"style":"BOLD"}],"type":"unstyled","key":"ea0fg","text":"1. Sign in to Azure Active Directory admin center > All services > Azure AD Conditional access > Named locations.","data":{},"entityRanges":[{"key":13,"length":15,"offset":97}],"depth":0},{"data":{},"depth":0,"entityRanges":[{"offset":0,"key":14,"length":1}],"inlineStyleRanges":[],"type":"atomic","key":"fubsa","text":" "},{"text":"2. Click IP ranges location. Set the name to \"Main office\". Click Mark as trusted location. Click the plus (+) sign and add your IP address + the subnet (for example 173.49.196.1/32). Click Add. Click Create.","key":"7pk4p","type":"unstyled","data":{},"depth":0,"entityRanges":[],"inlineStyleRanges":[{"style":"BOLD","offset":9,"length":18},{"style":"BOLD","length":24,"offset":66},{"offset":108,"length":1,"style":"BOLD"},{"offset":190,"length":3,"style":"BOLD"},{"length":6,"offset":201,"style":"BOLD"}]},{"key":"k3uo","inlineStyleRanges":[],"text":" ","entityRanges":[{"offset":0,"key":15,"length":1}],"data":{},"type":"atomic","depth":0},{"text":"3. Go back to Azure AD Conditional access > policies. Click New policy > Create new policy.","depth":0,"type":"unstyled","data":{},"entityRanges":[{"key":16,"length":8,"offset":44}],"key":"82f1h","inlineStyleRanges":[{"style":"BOLD","length":27,"offset":14},{"offset":44,"style":"BOLD","length":8},{"style":"BOLD","offset":60,"length":10},{"offset":73,"length":17,"style":"BOLD"}]},{"text":"4. Enter a name of “Require MFA”","depth":0,"data":{},"type":"unstyled","entityRanges":[],"inlineStyleRanges":[{"style":"BOLD","length":11,"offset":20}],"key":"1ghjg"},{"inlineStyleRanges":[{"length":39,"offset":9,"style":"BOLD"},{"style":"BOLD","length":9,"offset":56}],"text":"5. Click 0 users or workload identities selected. Click All users.","data":{},"type":"unstyled","depth":0,"entityRanges":[],"key":"dd9d1"},{"text":"6. Click No cloud apps, actions, or authentication contexts selected. Click All cloud apps.","type":"unstyled","entityRanges":[],"data":{},"key":"1lgnp","depth":0,"inlineStyleRanges":[{"offset":9,"style":"BOLD","length":59},{"length":14,"offset":76,"style":"BOLD"}]},{"inlineStyleRanges":[{"style":"BOLD","length":21,"offset":9},{"style":"BOLD","length":14,"offset":38}],"data":{},"type":"unstyled","key":"89j8i","depth":0,"text":"7. Click 0 conditions selected. Click Not configured located under Locations.","entityRanges":[]},{"data":{},"entityRanges":[],"text":"8. Set Configure to Yes.","inlineStyleRanges":[{"length":3,"style":"BOLD","offset":20}],"type":"unstyled","depth":0,"key":"alif2"},{"type":"unstyled","depth":0,"entityRanges":[],"key":"a9l85","data":{},"inlineStyleRanges":[{"style":"BOLD","length":7,"offset":9},{"style":"BOLD","length":18,"offset":24},{"offset":50,"style":"BOLD","length":4},{"length":11,"offset":62,"style":"BOLD"},{"style":"BOLD","length":6,"offset":81}],"text":"9. Click Exclude. Click Selected locations. Click None. Click Main Office. Click Select."},{"text":" ","depth":0,"data":{},"type":"atomic","key":"6och4","inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":1,"key":17}]},{"inlineStyleRanges":[{"style":"BOLD","length":19,"offset":10}],"entityRanges":[],"key":"b7tvf","type":"unstyled","depth":0,"data":{},"text":"10. Click 0 controls selected (under Grant)."},{"key":"1sddl","data":{},"entityRanges":[],"inlineStyleRanges":[{"offset":10,"style":"BOLD","length":35},{"style":"BOLD","length":6,"offset":53}],"text":"11. Click Require multi-factor authentication. Click Select.","type":"unstyled","depth":0},{"inlineStyleRanges":[{"length":2,"style":"BOLD","offset":10},{"style":"BOLD","length":6,"offset":42}],"depth":0,"type":"unstyled","data":{},"text":"12. Click On (under Enable policy). Click Create.","entityRanges":[],"key":"bfv3b"},{"type":"unstyled","key":"5htsf","data":{},"depth":0,"inlineStyleRanges":[],"entityRanges":[],"text":"Now when any user logs in from a location other than your main office they’ll need to apply their MFA. When they login from the main office they won’t need their MFA. Of course, if you set up the earlier policy where all admins had to use MFA then admins will be required to use MFA inside and outside the office."},{"key":"dchec","data":{},"entityRanges":[],"depth":0,"inlineStyleRanges":[],"text":"There’s a ton more you can do with conditional access policies including preventing users from downloading, printing, and syncing files in SharePoint Online and secure on-premises VPNs. Don’t worry, we’ll cover both of these options in a later lesson.","type":"unstyled"}],"entityMap":{"0":{"type":"LINK","data":{"targetOption":"_blank","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/PolicyBlade"},"mutability":"MUTABLE"},"1":{"type":"IMAGE","data":{"width":"auto","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","alt":"Create a conditional access policy","alignment":"none","targetOption":"_blank","height":"auto","src":"https://i.ibb.co/DQm1sY0/Create-conditional-access-policy.png"},"mutability":"MUTABLE"},"2":{"type":"IMAGE","mutability":"MUTABLE","data":{"url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","alignment":"left","height":"auto","width":"auto","targetOption":"_blank","src":"https://i.ibb.co/G7QBxPT/name-your-conditional-access-policy.png","alt":"Name your conditional access policy"}},"3":{"data":{"targetOption":"_blank","height":"auto","src":"https://i.ibb.co/ZBhyf3h/set-conditional-access-policy-to-apply-to-admins.png","alt":"set conditional access policy to apply to admins","width":"auto","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","alignment":"none"},"mutability":"MUTABLE","type":"IMAGE"},"4":{"type":"IMAGE","data":{"alignment":"none","alt":"Conditional access policy set all cloud apps","height":"auto","width":"auto","targetOption":"_blank","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","src":"https://i.ibb.co/K9J1dVJ/conditional-access-policy-set-all-cloud-apps.png"},"mutability":"MUTABLE"},"5":{"type":"IMAGE","data":{"alignment":"none","height":"auto","src":"https://i.ibb.co/PTQmjND/conditional-access-policy-require-mfa.png","alt":"conditional access policy require mfa","width":"auto","targetOption":"_blank","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations"},"mutability":"MUTABLE"},"6":{"data":{"src":"https://i.ibb.co/bJPCQ7w/conditional-access-warning.png","height":"auto","alt":"Conditional access warning: Don't lock yourself out! We recommend applying a policy to a small set of users first to verify it behaves as expected.","targetOption":"_blank","width":"auto","alignment":"none","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations"},"type":"IMAGE","mutability":"MUTABLE"},"7":{"mutability":"MUTABLE","type":"IMAGE","data":{"targetOption":"_blank","alt":"conditional access policy users or workload identities","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","src":"https://i.ibb.co/5rJVTmz/conditional-access-policy-users-or-workload-identities.png","alignment":"none","width":"auto","height":"auto"}},"8":{"data":{"targetOption":"_blank","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","width":"auto","height":"auto","alignment":"none","alt":"Conditional access policy cloud apps or actions","src":"https://i.ibb.co/X7XTxRK/Conditional-access-policy-cloud-apps-or-actions.png"},"type":"IMAGE","mutability":"MUTABLE"},"9":{"mutability":"MUTABLE","data":{"height":"auto","width":"auto","alt":"conditional access policy conditions","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","alignment":"none","src":"https://i.ibb.co/Yypqyqs/conditional-access-policy-conditions.png","targetOption":"_blank"},"type":"IMAGE"},"10":{"type":"IMAGE","data":{"src":"https://i.ibb.co/K5PZLY8/conditional-access-policy-grant.png","height":"auto","targetOption":"_blank","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","alt":"Conditional access policy grant","alignment":"none","width":"auto"},"mutability":"MUTABLE"},"11":{"data":{"alignment":"none","alt":"conditional access policy session","src":"https://i.ibb.co/jDj8CpP/conditional-access-policy-session.png","width":"auto","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","height":"auto","targetOption":"_blank"},"mutability":"MUTABLE","type":"IMAGE"},"12":{"mutability":"MUTABLE","data":{"url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","alignment":"none","src":"https://i.ibb.co/SBvR7ry/conditional-access-policy-logs.png","height":"auto","alt":"conditional access policy logs","targetOption":"_blank","width":"auto"},"type":"IMAGE"},"13":{"type":"LINK","data":{"url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations","targetOption":"_blank"},"mutability":"MUTABLE"},"14":{"type":"IMAGE","mutability":"MUTABLE","data":{"alt":"conditional access policy new named location","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/Policies","src":"https://i.ibb.co/G54Sy34/conditional-access-policy-new-named-location.png","width":"auto","height":"auto","alignment":"none","targetOption":"_blank"}},"15":{"type":"IMAGE","data":{"targetOption":"_blank","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/Policies","src":"https://i.ibb.co/nshF1qX/conditional-access-policy-named-location-by-ip-address.png","alt":"conditional access policy named location by ip address","height":"auto","alignment":"none","width":"auto"},"mutability":"MUTABLE"},"16":{"data":{"targetOption":"_blank","url":"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/Policies"},"type":"LINK","mutability":"MUTABLE"},"17":{"type":"IMAGE","data":{"alt":"conditional access policy exclude location","height":"auto","alignment":"none","width":"auto","src":"https://i.ibb.co/zb3v6Nm/conditional-access-policy-exclude-location.png"},"mutability":"MUTABLE"}}},"sectionId":"AFV_acckJ","datePublished":"2022/5/26","id":"V1en9Iugh","slug":"Whats-a-conditional-access-policy-V1en9Iugh","publish":true},
      articles: [{"id":"cpchjBLkC","sectionId":"qwJW5VrBW","slug":"Whats-in-this-course-cpchjBLkC","title":"What's in this course?","featuredImage":"https://i.ibb.co/zFs9Vfb/microsoft365-security-administrator-associate-600x600.png"},{"id":"KKkBOVuS4","sectionId":"qwJW5VrBW","slug":"Creating-a-free-Microsoft-365-tenant-for-practice-KKkBOVuS4","title":"Creating a free Microsoft 365 tenant for practice","featuredImage":"https://i.ibb.co/F07sjQJ/microsoft-365-e5-trial.png"},{"id":"bzotoOjEe","sectionId":"qwJW5VrBW","slug":"Managing-the-Microsoft-365-tenant-Introduction-to-the-admin-centers-bzotoOjEe","title":"Managing the Microsoft 365 tenant - Introduction to the admin centers","featuredImage":"https://i.ibb.co/f1cr4zt/Microsoft-365-admin-centers.png"},{"id":"cg_vxOX9L","sectionId":"qwJW5VrBW","slug":"Managing-Microsoft-365-through-PowerShell-cg_vxOX9L","title":"Managing Microsoft 365 through PowerShell","featuredImage":"https://i.ibb.co/HV13YF6/install-microsoft-365-powershell-modules.png"},{"id":"uYCIPbnMC","sectionId":"AFV_acckJ","slug":"How-to-create-users-in-Microsoft-365-Cloud-Only-uYCIPbnMC","title":"How to create users in Microsoft 365 Cloud Only","featuredImage":"https://i.ibb.co/Wnt5Q43/View-Microsoft-365-Users.png"},{"id":"7CpqFkPZU","sectionId":"AFV_acckJ","slug":"Creating-and-managing-admins-through-roles-7CpqFkPZU","title":"Creating and managing admins through roles","featuredImage":"https://i.ibb.co/kySL4HQ/Roles-and-administrators.png"},{"id":"rZzausKJ1","sectionId":"AFV_acckJ","slug":"Time-limited-admin-roles-in-Microsoft-365-rZzausKJ1","title":"Time limited admin roles in Microsoft 365","featuredImage":"https://i.ibb.co/nDvjyPD/select-member-to-add-to-PIM-role.png"},{"id":"ky5W0Lz5P","sectionId":"AFV_acckJ","slug":"Whats-AD-Connect-ky5W0Lz5P","title":"What's AD Connect","featuredImage":"https://i.ibb.co/7nDqr9x/Whats-AD-Connect.png"},{"id":"i9pJIjTNH","sectionId":"AFV_acckJ","slug":"Protecting-Passwords-in-Microsoft-365-i9pJIjTNH","title":"Protecting Passwords in Microsoft 365","featuredImage":"https://i.ibb.co/DLD4G4q/access-smart-lockout-settings.png"},{"id":"S1hQgFOMV","sectionId":"AFV_acckJ","slug":"Creating-and-managing-users-through-groups-S1hQgFOMV","title":"Creating and managing users through groups","featuredImage":"https://i.ibb.co/nmmC28M/add-a-group-microsoft-365.png"},{"id":"2QfoI2HxY","sectionId":"AFV_acckJ","slug":"Securing-and-implementing-enterprise-applications-2QfoI2HxY","title":"Securing and implementing enterprise applications","featuredImage":"https://i.ibb.co/C2mp69m/disable-user-consent.png"},{"id":"V1en9Iugh","sectionId":"AFV_acckJ","slug":"Whats-a-conditional-access-policy-V1en9Iugh","title":"What's a conditional access policy?","featuredImage":"https://i.ibb.co/DQm1sY0/Create-conditional-access-policy.png"},{"id":"nAAIvNbtk","sectionId":"AFV_acckJ","slug":"The-many-ways-to-implement-multi-factor-authentication-MFA-in-Microsoft-365-nAAIvNbtk","title":"The many ways to implement multi-factor authentication (MFA) in Microsoft 365","featuredImage":"https://i.ibb.co/P1P0wNY/microsoft-365-manage-security-defaults.png"},{"id":"2S9jn0aLr","sectionId":"AFV_acckJ","slug":"Implement-Self-service-password-reset-in-Microsoft-365-2S9jn0aLr","title":"Implement Self-service password reset in Microsoft 365","featuredImage":"https://i.ibb.co/58y9JVg/write-back-passwords-to-on-premises-directory.png"},{"id":"FldNualGC","sectionId":"AFV_acckJ","slug":"Locking-down-your-Microsoft-365-tenant-from-Microsoft-engineers-FldNualGC","title":"Locking down your Microsoft 365 tenant from Microsoft engineers","featuredImage":"https://i.ibb.co/DCmpnT9/Enable-Customer-Lockbox.png"},{"id":"NFQ6rYFeQ","sectionId":"AFV_acckJ","slug":"Implementing-intelligent-security-using-risk-policies-in-Microsoft-365-NFQ6rYFeQ","title":"Implementing intelligent security using risk policies in Microsoft 365","featuredImage":"https://i.ibb.co/0cyQJ7j/Risk-Detections.png"},{"id":"rK48f6iM2","sectionId":"AFV_acckJ","slug":"Automating-Access-Review-in-Microsoft-365-rK48f6iM2","title":"Automating Access Review in Microsoft 365","featuredImage":"https://i.ibb.co/Xsxvz6Z/new-access-review.png"},{"id":"RHW1API2s","sectionId":"AFV_acckJ","slug":"Just-in-time-approval-and-notification-for-admin-roles-in-Microsoft-365-RHW1API2s","title":"Just in time, approval and notification for admin roles in Microsoft 365","featuredImage":"https://i.ibb.co/dcb6XFN/Activate-a-Role.png"},{"id":"z8EMM9Eu_","sectionId":"QScYfSu74","slug":"Whats-Microsoft-365-Defender-z8EMM9Eu_","title":"What's Microsoft 365 Defender?","featuredImage":"https://i.ibb.co/MDMyDQt/Microsoft-Defender.png"},{"id":"Kye_yNLxA","sectionId":"QScYfSu74","slug":"Whats-Microsoft-Defender-for-identity-Kye_yNLxA","title":"What's Microsoft Defender for identity?","featuredImage":"https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png"},{"id":"EnPyp7ukN","sectionId":"QScYfSu74","slug":"Whats-Microsoft-Defender-for-Office-365-EnPyp7ukN","title":"What's Microsoft Defender for Office 365?","featuredImage":"https://i.ibb.co/WcwKY2G/Microsoft-365-incidents-and-alerts.png"},{"id":"6HUOr7qbL","sectionId":"QScYfSu74","slug":"Protect-your-email-environment-from-malicious-actors-6HUOr7qbL","title":"Protect your email and Office environment from malicious actors","featuredImage":"https://i.ibb.co/Df0KQVp/Reports.png"},{"id":"GCOOUsSBT","sectionId":"QScYfSu74","slug":"Protecting-email-against-phishing-attacks-GCOOUsSBT","title":"Protecting email against phishing attacks","featuredImage":"https://i.ibb.co/GCjZHWg/edit-actions.png"},{"id":"GG4cMY8pK","sectionId":"QScYfSu74","slug":"Simulating-attacks-with-Microsoft-365-GG4cMY8pK","title":"Simulating attacks with Microsoft 365","featuredImage":"https://i.ibb.co/NyvnbMK/simulation-overview-view-users-circled.png"},{"id":"z0qPG6v4T","sectionId":"QScYfSu74","slug":"Protecting-Windows-10-and-other-devices-with-Microsoft-Defender-for-Endpoint-z0qPG6v4T","title":"Protecting Windows 10 and other devices with Microsoft Defender for Endpoint","featuredImage":"https://i.ibb.co/T47Xhyh/enable-endpoint-connections.png"},{"id":"LEyZMWBSt","sectionId":"QScYfSu74","slug":"Collect-detect-investigate-and-respond-to-security-threats-using-Microsoft-Sentinel-LEyZMWBSt","title":"Collect, detect, investigate, and respond to security threats using Microsoft Sentinel","featuredImage":"https://i.ibb.co/qN9XsKj/Add-Workbook.png"},{"id":"7MQ3wE4wP","sectionId":"QScYfSu74","slug":"Implement-and-manage-Microsoft-Defender-for-Cloud-Apps-7MQ3wE4wP","title":"Implement and manage Microsoft Defender for Cloud Apps","featuredImage":"https://i.ibb.co/7g7LvFg/office-365-cloud-apps-settings.png"},{"id":"sH_Ee1DW1","sectionId":"QScYfSu74","slug":"Auditing-sign-ins-and-other-actions-in-Microsoft-365-sH_Ee1DW1","title":"Auditing sign-ins and other actions in Microsoft 365","featuredImage":"https://i.ibb.co/BqMw3jZ/Start-recording-user-and-admin-activity.png"},{"id":"vLweLmxZf","sectionId":"YhftdGIRX","slug":"How-to-classify-data-using-labels-in-Microsoft-365-vLweLmxZf","title":"How to classify data using labels in Microsoft 365","featuredImage":"https://i.ibb.co/k9nhWS5/Choose-protection-settings-for-files-and-emails.png"},{"id":"NsF7No40f","sectionId":"YhftdGIRX","slug":"Creating-and-managing-data-retention-to-conform-to-compliance-NsF7No40f","title":"Creating and managing data retention to conform to compliance","featuredImage":"https://i.ibb.co/yqC0ZdY/New-Retention-Policy.png"},{"id":"IsPGsme8w","sectionId":"YhftdGIRX","slug":"Preventing-accidental-and-malicious-data-loss-with-DLP-policies-IsPGsme8w","title":"Preventing accidental and malicious data loss with DLP policies","featuredImage":"https://i.ibb.co/n8WcqKM/Create-a-DLP-policy.png"},{"id":"wv2PbXnhI","sectionId":"YhftdGIRX","slug":"Everything-you-need-to-know-about-securing-SharePoint-Online-for-the-MS-500-wv2PbXnhI","title":"Everything you need to know about securing SharePoint Online for the MS-500","featuredImage":"https://i.ibb.co/Gk9NjSH/Share-Point-Online-Warning.png"},{"id":"7gR3L122b","sectionId":"l0DxUuonW","slug":"Introduction-to-Intune-7gR3L122b","title":"Introduction to Intune","featuredImage":"https://i.ibb.co/Fq3N8BX/Endpoint-Manager-Admin-Center.png"},{"id":"ZyKX3Idjs","sectionId":"l0DxUuonW","slug":"Setting-up-Android-Devices-ZyKX3Idjs","title":"Setting up Android Devices","featuredImage":"https://i.ibb.co/m0BYhL2/Connect-Intune-to-Google-Play.png"},{"id":"MAjW0a2_p","sectionId":"l0DxUuonW","slug":"Setting-up-Apple--iOS-devices-in-Intune-MAjW0a2_p","title":"Setting up Apple / iOS devices in Intune","featuredImage":"https://i.ibb.co/X7Ffb2B/Setup-Apple-Enrollment-in-Intune.png"},{"id":"XFXu2zIS9","sectionId":"l0DxUuonW","slug":"Setting-up-Windows-10-devices-in-Intune-XFXu2zIS9","title":"Setting up Windows 10 devices in Intune","featuredImage":"https://i.ibb.co/WDXKVjW/configure-device-options.png"},{"id":"_LL9VqGZO","sectionId":"l0DxUuonW","slug":"How-to-manage-devices-using-Intune-_LL9VqGZO","title":"How to manage devices using Intune","featuredImage":"https://i.ibb.co/HPQ2m8t/Create-an-endpoint-protection-profile.png"},{"id":"qDRA4jjoN","sectionId":"l0DxUuonW","slug":"Understanding-compliance-policies-qDRA4jjoN","title":"Understanding compliance policies","featuredImage":"https://i.ibb.co/N3Qk57v/Create-a-compliance-policy.png"},{"id":"62t_7oiZx","sectionId":"l0DxUuonW","slug":"Restricting-and-managing-apps-on-user-devices-62t_7oiZx","title":"Restricting and managing apps on user devices","featuredImage":"https://i.ibb.co/PCVRKDf/Add-an-Android-app-to-Intune.png"}],
      articleHtml: `<p>Conditional access policies help organizations improve security and compliance. They are used to fine-tune and customize the authentication of your users in Microsoft 365. Let me explain.&nbsp;</p>
<p>In the simplest terms, it’s a series of if statements. For example, you can create a conditional access policy to require all members of a particular group to use Multi-Factor Authentication to log in to Microsoft 365. “If the user is part of group X then require MFA”.</p>
<p>You can set a lot of different options in conditional access policies. For example, you can create a policy so a certain set of users can only log in from specific IP addresses. “If the user is part of group X and not logging in from IP address 1.1.1.1 then block access”</p>
<h2>License Requirements</h2>
<p>You’re required to have an Azure AD Premium P1, Azure AD Premium P2 license, or Microsoft 365 Business Premium license. The Conditional access policies are also included in the following licenses:</p>
<ul>
<li>Microsoft 365 E3 &amp; E5</li>
<li>Microsoft 365 F3</li>
<li>Enterprise Mobility + Security E3 (EMS E3), and E5 (EMS E5)</li>
</ul>
<h2>Creating your first conditional access policy</h2>
<p>Let’s create a conditional access policy that requires all our admins to use MFA to sign in to Microsoft 365.</p>
<p>1. log in to Azure Active Directory admin center &gt; All services &gt; Azure AD Conditional Access &gt; New Policy &gt; <a href="https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/PolicyBlade" target="_blank">Create new policy</a>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/DQm1sY0/Create-conditional-access-policy.png" alt="Create a conditional access policy" style="height: auto;width: auto"/></div>
<p>2. Set the <strong>name </strong>to “Require MFA for admins”.</p>
<div style="text-align:left;"><img src="https://i.ibb.co/G7QBxPT/name-your-conditional-access-policy.png" alt="Name your conditional access policy" style="height: auto;width: auto"/></div>
<p>3. Click <strong>0 users or workload identities selected</strong>. Click <strong>Select users and groups</strong> &gt; <strong>Directory roles</strong>. Then click each role that has administrator in its name.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/ZBhyf3h/set-conditional-access-policy-to-apply-to-admins.png" alt="set conditional access policy to apply to admins" style="height: auto;width: auto"/></div>
<p>4. Click <strong>No cloud apps, actions, or authentication contexts selected</strong>. Click <strong>All cloud apps</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/K9J1dVJ/conditional-access-policy-set-all-cloud-apps.png" alt="Conditional access policy set all cloud apps" style="height: auto;width: auto"/></div>
<p>5. Click<strong> 0 controls selected</strong> under Grant. Click <strong>Require multi-factor authentication</strong>. Click <strong>Select</strong>. Click <strong>On</strong> under Enable policy.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/PTQmjND/conditional-access-policy-require-mfa.png" alt="conditional access policy require mfa" style="height: auto;width: auto"/></div>
<p>6. At this point you may see a warning say “Don’t lock yourself out!”. Read the recommendation carefully and then make your decision whether to exclude yourself from the policy.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/bJPCQ7w/conditional-access-warning.png" alt="Conditional access warning: Don't lock yourself out! We recommend applying a policy to a small set of users first to verify it behaves as expected." style="height: auto;width: auto"/></div>
<p>7. Click <strong>Create</strong>.</p>
<p>That’s it. You are now requiring your administrators to configure and use MFA when they log in to Office 365. Now let’s break down the parts of the conditional access policy configuration.</p>
<h2>Understanding conditional access policies</h2>
<p>The conditional access policy is broken into two sections: assignments and Access controls.</p>
<p>The assignments section is the filters. This is where you can decide which users, device OS’s, and apps the policy affects.</p>
<p>The Access controls section provides your allowed / block controls. It’s also where you can decide things like “require MFA” or block persistent browser sessions.</p>
<h3>User or workload identities</h3>
<div style="text-align:none;"><img src="https://i.ibb.co/5rJVTmz/conditional-access-policy-users-or-workload-identities.png" alt="conditional access policy users or workload identities" style="height: auto;width: auto"/></div>
<p>In this section, you’re deciding which user accounts will be affected by the policy. You can set up a specific list of users, for example, yourself to test out a policy. You can select a group that would include everyone in the group or you can select admin roles to affect only users that are assigned the specific admin role. Lastly, you can exclude users. So you can create a policy to include All users, then you can exclude guest and external users.</p>
<p><em>Remember, the exclusion will take precedence. So if you select to include a user then exclude the user, the user will be excluded from the policy.</em></p>
<h3>Cloud apps or actions</h3>
<div style="text-align:none;"><img src="https://i.ibb.co/X7XTxRK/Conditional-access-policy-cloud-apps-or-actions.png" alt="Conditional access policy cloud apps or actions" style="height: auto;width: auto"/></div>
<p>The cloud apps or actions section is where you can filter the conditional access policy based on the app. For example, you may need to require MFA for email access but all other access doesn’t require MFA. If you only wanted the policy to affect email then you would click Select apps &gt; Office 365 Exchange Online.</p>
<h3>Conditions</h3>
<div style="text-align:none;"><img src="https://i.ibb.co/Yypqyqs/conditional-access-policy-conditions.png" alt="conditional access policy conditions" style="height: auto;width: auto"/></div>
<p>Conditions provide an additional layer of filtering. From here you can select if the policy only affects the users when certain other criteria is met. For example, you may want to require MFA only when there’s a high User / sign-in risk. Or you may want to block access altogether from certain countries. Or maybe there are no Android devices in your organization. You can easily select Android devices from this page.</p>
<h3>Access Controls: Grant</h3>
<div style="text-align:none;"><img src="https://i.ibb.co/K5PZLY8/conditional-access-policy-grant.png" alt="Conditional access policy grant" style="height: auto;width: auto"/></div>
<p>From the access controls &gt; grant section you can decide what happens when the criteria above is met. For example, you may want to block access. Or you may want to require multi-factor authentication. Or you may want to require the device to be marked compliant in Intune. It’s all possible in the conditional access policies.</p>
<h3>Access Controls: Session</h3>
<div style="text-align:none;"><img src="https://i.ibb.co/jDj8CpP/conditional-access-policy-session.png" alt="conditional access policy session" style="height: auto;width: auto"/></div>
<p>Finally, the session controls. From the session tab, you can set if the user can save their browser session or if they have to sign in again after closing the browser. Or you can set how often users need to re-authenticate when using apps like Outlook or Microsoft Teams.</p>
<h2>Review the status of conditional access policies</h2>
<p>So, you may be wondering, if I create a policy that blocks sign-ins from non-compliant devices how can I view who’s getting blocked? Fortunately, Microsoft has made it easy.</p>
<p>1. Sign in to <strong>Azure Active Directory admin center</strong> &gt; <strong>Users </strong>&gt; <strong>Sign in logs</strong> &gt; click the sign-in you want to investigate &gt; <strong>Conditional access</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/SBvR7ry/conditional-access-policy-logs.png" alt="conditional access policy logs" style="height: auto;width: auto"/></div>
<p>From this page you can see all the conditional access policies, whether they were applied to the sign in and whether the attempt passed or failed. To see more information on the conditional access policy click on it.</p>
<h2>Force multi-factor authentication while not in the main office</h2>
<p>Now, let’s get a little trickier. Let’s say the MFA prompt every time a user logs on is too much for your organization. Maybe you only want to prompt for MFA when users are not in your main office. How do you do it?</p>
<p>1. Sign in to <strong>Azure Active Directory admin center</strong> &gt; <strong>All services</strong> &gt; <strong>Azure AD Conditional access</strong> &gt; <a href="https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/NamedLocations" target="_blank"><strong>Named locations</strong></a>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/G54Sy34/conditional-access-policy-new-named-location.png" alt="conditional access policy new named location" style="height: auto;width: auto"/></div>
<p>2. Click <strong>IP ranges location</strong>. Set the name to "Main office". Click <strong>Mark as trusted location</strong>. Click the plus (<strong>+</strong>) sign and add your IP address + the subnet (for example 173.49.196.1/32). Click <strong>Add</strong>. Click <strong>Create</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/nshF1qX/conditional-access-policy-named-location-by-ip-address.png" alt="conditional access policy named location by ip address" style="height: auto;width: auto"/></div>
<p>3. Go back to <strong>Azure AD Conditional access</strong> &gt; <a href="https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/Policies" target="_blank"><strong>policies</strong></a>. Click <strong>New policy</strong> &gt; <strong>Create new policy</strong>.</p>
<p>4. Enter a name of “<strong>Require MFA</strong>”</p>
<p>5. Click <strong>0 users or workload identities selected</strong>. Click <strong>All users</strong>.</p>
<p>6. Click <strong>No cloud apps, actions, or authentication contexts selected</strong>. Click <strong>All cloud apps</strong>.</p>
<p>7. Click <strong>0 conditions selected</strong>. Click <strong>Not configured</strong> located under Locations.</p>
<p>8. Set Configure to <strong>Yes</strong>.</p>
<p>9. Click <strong>Exclude</strong>. Click <strong>Selected locations</strong>. Click <strong>None</strong>. Click <strong>Main Office</strong>. Click <strong>Select</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/zb3v6Nm/conditional-access-policy-exclude-location.png" alt="conditional access policy exclude location" style="height: auto;width: auto"/></div>
<p>10. Click <strong>0 controls selected</strong> (under Grant).</p>
<p>11. Click <strong>Require multi-factor authentication</strong>. Click <strong>Select</strong>.</p>
<p>12. Click <strong>On</strong> (under Enable policy). Click <strong>Create</strong>.</p>
<p>Now when any user logs in from a location other than your main office they’ll need to apply their MFA. When they login from the main office they won’t need their MFA. Of course, if you set up the earlier policy where all admins had to use MFA then admins will be required to use MFA inside and outside the office.</p>
<p>There’s a ton more you can do with conditional access policies including preventing users from downloading, printing, and syncing files in SharePoint Online and secure on-premises VPNs. Don’t worry, we’ll cover both of these options in a later lesson.</p>
`,
      nextContentSlug: 'The-many-ways-to-implement-multi-factor-authentication-MFA-in-Microsoft-365-nAAIvNbtk',
      previousContentSlug: 'Securing-and-implementing-enterprise-applications-2QfoI2HxY',
      hasCompletedContent: false,
      userAcct: {completedContent: []}
    }
  }

  componentDidMount() {
    this.onAuthStateChangedListener = onAuthStateChanged((user) => {
      if (user) {
        getDoc('courses/MS-500/users', user.uid).then((userAcct) => {
          if (!userAcct.completedContent) {
            userAcct.completedContent = []
          }
          this.setState({userAcct})
        })
      }
    })

    if (isBrowser()) {
      document.addEventListener('scroll', this.trackScrolling)
      this.setState({isTrackScrolling: true})
    }

    if (this.state.course.COURSE) {
      getDoc('courses', 'MS-500').then((course) => {
        this.setState({course})

        if (this.state.articles[0] === 'ARTICLES') {
          getAllDocs('courses/MS-500/contents').then((articles) => {
            const contentSorted = sort(course, articles)
            this.setState({ articles: contentSorted })

            if (this.state.article.ARTICLE) {
              getDoc('courses/MS-500/contents', '2QfoI2HxY').then((article) => {
                const articleHtml = draftToHtml(article.article)

                const idx = course.contentOrder.indexOf(article.id)

                const nextContentSlug = idx < articles.length - 1 ? contentSorted[idx + 1].slug : this.state.nextContentSlug
                const previousContentSlug = idx > 0 ? contentSorted[idx - 1].slug : this.state.previousContentSlug

                this.setState({article, articleHtml, nextContentSlug, previousContentSlug})
              })
            }
          })
        }
      })
    }
  }

  componentWillUnmount() {
    if (isBrowser() && this.state.isTrackScrolling)
      document.removeEventListener('scroll', this.trackScrolling);

    this.onAuthStateChangedListener()
  }

  trackScrolling() {
    if (document.body.scrollHeight * .8 < window.innerHeight + window.scrollY) {
      this.setHasCompletedContent(true)
    }
  }

  setHasCompletedContent(val) {
    if (val === true) {
      document.removeEventListener('scroll', this.trackScrolling);
      this.setState({isTrackScrolling: false})

      if (this.state.userAcct.id) {
        const userAcct = this.state.userAcct

        if (!userAcct.completedContent.includes(this.state.article.id)) {
          userAcct.completedContent.push(this.state.article.id)
          this.setState({userAcct})
          saveDoc('courses/MS-500/users', userAcct)
        }
      }
    }
  }

  render() {
    const jsonLd = {
      headline: this.state.article.title,
      datePublished: this.state.article.datePublished,
      keywords: [
        "Microsoft",
        "Microsoft 365",
        "Office 365",
        'MS-500',
        'Microsoft 365 Security Administration'
      ],
      "author": {
        "@type": "Person",
        "name": "John Gruber",
        url: 'https://medium.com/@gruberjl'
      }
    }

    return (
      <Page jsonLdType={'BlogPosting'} jsonLd={jsonLd} image={this.state.article.featuredImage} canonical={this.props.location.href} title={this.state.article.title} description={this.state.article.description}>
        <main>
          <Container fluid>
            <Row>
              <Col lg={9}>
                <Container>
                  <h1 style={marginTop24Style}>{this.state.article.title}</h1>
                  <div dangerouslySetInnerHTML={{__html: this.state.articleHtml}} className='img-width-100 article'></div>
                  <div className='flex-space-between margin12'>
                    <Link to={ this.state.previousContentSlug === 'PREVIOUS_CONTENT' ? '/' : `/course/ms-500/learn/${this.state.previousContentSlug}` }><IoChevronBack /> Previous</Link>
                    <Link to={ this.state.nextContentSlug === 'NEXT_CONTENT' ? '/' : `/course/ms-500/learn/${this.state.nextContentSlug}` }>Next <IoChevronForward /></Link>
                  </div>
                </Container>
              </Col>
              <Col lg={3}>
                <Accordion defaultActiveKey="0">
                  {this.state.course.sections.map((section, idx) => (
                    <Accordion.Item eventKey={idx} key={idx}>
                      <Accordion.Header>{section.title}</Accordion.Header>
                      <Accordion.Body style={removePaddingStyle}>
                        <ListGroup defaultActiveKey={`/course/ms-500/learn/${this.state.currentSlug}`} variant="flush">
                          { this.state.articles.filter(article => article.sectionId === section.id).map((article, articleIdx) => (
                            <ListGroup.Item style={listItemStyle} action to={`/course/ms-500/learn/${article.slug}`} href={`/course/ms-500/learn/${article.slug}`} as={Link} key={articleIdx} className='navigation-item'>
                              <Form.Check label={article.title} checked={this.state.userAcct.completedContent.includes(article.id)} onChange={() => {}} />
                            </ListGroup.Item>
                          ))}
                        </ListGroup>
                      </Accordion.Body>
                    </Accordion.Item>
                  ))}
                </Accordion>
              </Col>
            </Row>
          </Container>
        </main>
      </Page>
    )
  }
}

export default ArticlePage
