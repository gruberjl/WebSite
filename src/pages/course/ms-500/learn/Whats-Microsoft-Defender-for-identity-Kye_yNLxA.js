import * as React from "react"
import Page from '../../../../components/page'
import Container from 'react-bootstrap/Container'
import Row from 'react-bootstrap/Row'
import Col from 'react-bootstrap/Col'
import Accordion from 'react-bootstrap/Accordion'
import ListGroup from 'react-bootstrap/ListGroup'
import Form from 'react-bootstrap/Form'
import { Link } from "gatsby"
import {getDoc, getAllDocs, saveDoc, onAuthStateChanged} from '../../../../components/firebase'
import draftToHtml from 'draftjs-to-html'
import { IoChevronBack, IoChevronForward } from "react-icons/io5";
 
const isBrowser = () => typeof window !== 'undefined'

const removePaddingStyle = {
  padding: '0px'
}

const marginTop24Style = {
  marginTop: '24px'
}

const listItemStyle = {
  border: 'none',
  paddingTop: '12px',
  paddingBottom: '12px'
}

const sort = (course, articles) => {
  return articles.sort((a, b) => {
    return course.contentOrder.indexOf(a.id) - course.contentOrder.indexOf(b.id)
  })
}

class ArticlePage extends React.Component {
  constructor(props) {
    super(props)
    this.trackScrolling = this.trackScrolling.bind(this)
    this.setHasCompletedContent = this.setHasCompletedContent.bind(this)

    let currentSlug = props.location.pathname.replace('/course/ms-500/learn/', '').split('/')[0]
    if (currentSlug === 'article')
      currentSlug = 'Securing-and-implementing-enterprise-applications-2QfoI2HxY'

    this.state = {
      currentSlug: currentSlug,
      isTrackScrolling: false,
      course: {"title":"Training for MS-500: Microsoft Office 365 Security Admin","id":"MS-500","sections":[{"order":0,"title":"Introduction","id":"qwJW5VrBW"},{"title":"Securing identity and access to Microsoft 365","order":1,"id":"AFV_acckJ"},{"order":2,"id":"QScYfSu74","title":"Securing Microsoft 365, clouds, and on-premises environments"},{"order":3,"title":"Protecting your environment from accidental and malicious data loss","id":"YhftdGIRX"},{"title":"Protecting User devices using Intune","order":4,"id":"l0DxUuonW"}],"audience":"Anyone who wants to learn about securing Microsoft 365","description":"Learn, prepare and training for the Microsoft Microsoft Office 365 Exam MS-500: Microsoft 365 Security Administration MS-500 exam","contentOrder":["cpchjBLkC","KKkBOVuS4","bzotoOjEe","cg_vxOX9L","uYCIPbnMC","7CpqFkPZU","rZzausKJ1","ky5W0Lz5P","i9pJIjTNH","S1hQgFOMV","2QfoI2HxY","V1en9Iugh","nAAIvNbtk","2S9jn0aLr","FldNualGC","NFQ6rYFeQ","rK48f6iM2","RHW1API2s","z8EMM9Eu_","Kye_yNLxA","EnPyp7ukN","6HUOr7qbL","GCOOUsSBT","GG4cMY8pK","z0qPG6v4T","LEyZMWBSt","7MQ3wE4wP","sH_Ee1DW1","vLweLmxZf","NsF7No40f","IsPGsme8w","wv2PbXnhI","7gR3L122b","ZyKX3Idjs","MAjW0a2_p","XFXu2zIS9","_LL9VqGZO","qDRA4jjoN","62t_7oiZx"]},
      article: {"images":["https://i.ibb.co/r4mpPNq/Microsoft-Defender-for-Identity-Setup.png","https://i.ibb.co/zfjrs6K/Open-Defender-for-Identity.png","https://i.ibb.co/4FyCGbZ/Open-Defender-for-Identity.png","https://i.ibb.co/0jhdMwP/defender-for-identity-create.png","https://i.ibb.co/qsYwScq/Defender-for-Identity-Directory-Services.png","https://i.ibb.co/ZXQX5Rd/Open-Microsoft-Defender-for-Cloud-Apps.png","https://i.ibb.co/w6TtrRt/defender-for-identity-download-sensors.png","https://i.ibb.co/BBV6hs7/Microsoft-Defender-for-Identity-Sensor-Install-Choose-Language.png","https://i.ibb.co/xgVRBHc/Microsoft-Defender-for-Identity-Sensor-Install-Deployment-Type.png","https://i.ibb.co/DzKrx0z/Microsoft-Defender-for-Identity-Sensor-Install-Configure-the-Sensor.png","https://i.ibb.co/FzXLp2J/defender-for-identity-DCs.png","https://i.ibb.co/F5dcMLV/AD-Properties.png","https://i.ibb.co/375P8GM/Add-Advanced-Permissions.png","https://i.ibb.co/MkCvDqj/select-a-principal.png","https://i.ibb.co/7jsFRLc/Applies-to.png","https://i.ibb.co/vvjdwDy/User-Permissions.png","https://i.ibb.co/YbPw0Zc/group-objects.png","https://i.ibb.co/T2bgwNJ/group-permissions.png","https://i.ibb.co/8sSxWZV/add-credentials-for-action-accounts.png","https://i.ibb.co/9nC0B4Z/tag-sensitive-accounts.png","https://i.ibb.co/s58V9jq/honeytoken-account-creation.png","https://i.ibb.co/3cFcT2J/honeytoken-account-setup.png","https://i.ibb.co/f0NNnnb/Defender-for-Cloud-Apps-integration-with-Defender-for-Identity.png","https://i.ibb.co/qW4W1SS/Enable-Integration-Between-Defender-for-Endpoint-and-Defender-for-Identity.png","https://i.ibb.co/WkvGhbd/Enable-Defender-for-Identity-and-endpoint-integration.png","https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png","https://i.ibb.co/G9qzFPn/Honeytoken-breach-in-microsoft-defender.png","https://i.ibb.co/nbDKcWs/Defender-for-Cloud-Apps-Alerts.png","https://i.ibb.co/KhQT36Y/delay-updates.png","https://i.ibb.co/0f5jTYk/standalone-sensor.png"],"id":"Kye_yNLxA","type":"article","datePublished":"2022/5/26","description":"Microsoft Defender for Identity is designed to protect your on-premises Active Directory (AD) and Active Directory Federation Services (ADFS). Microsoft Defender for Identity can perform the following:","title":"What's Microsoft Defender for identity?","article":{"entityMap":{"0":{"data":{"width":"auto","src":"https://i.ibb.co/4FyCGbZ/Open-Defender-for-Identity.png","targetOption":"_blank","url":"https://portal.atp.azure.com/","alt":"How to open the Microsoft Defender for Identity Portal","alignment":"left","height":"auto"},"type":"LINK","mutability":"MUTABLE"},"1":{"data":{"width":"auto","alt":"How to open the Microsoft Defender for Identity Portal","alignment":"none","src":"https://i.ibb.co/4FyCGbZ/Open-Defender-for-Identity.png","height":"auto"},"mutability":"MUTABLE","type":"IMAGE"},"2":{"mutability":"MUTABLE","type":"IMAGE","data":{"src":"https://i.ibb.co/zfjrs6K/Open-Defender-for-Identity.png","alignment":"left","alt":"How to open Microsoft Defender for Identity","width":"auto","height":"auto"}},"3":{"type":"IMAGE","data":{"alt":"Create the Defender for Identity instance","height":"auto","width":"auto","src":"https://i.ibb.co/0jhdMwP/defender-for-identity-create.png","alignment":"none"},"mutability":"MUTABLE"},"4":{"data":{"width":"auto","alignment":"none","alt":"Setup directory services with Defender for Identity","height":"auto","src":"https://i.ibb.co/qsYwScq/Defender-for-Identity-Directory-Services.png"},"type":"IMAGE","mutability":"MUTABLE"},"5":{"mutability":"MUTABLE","data":{"src":"https://i.ibb.co/r4mpPNq/Microsoft-Defender-for-Identity-Setup.png","height":"auto","alignment":"left","width":"auto","alt":"Microsoft Defender for Identity creation"},"type":"IMAGE"},"6":{"type":"LINK","mutability":"MUTABLE","data":{"url":"https://portal.atp.azure.com/","targetOption":"_blank"}},"7":{"mutability":"MUTABLE","data":{"targetOption":"_blank","height":"auto","alt":"Microsoft Defender for identity sensors","alignment":"none","width":"auto","src":"https://i.ibb.co/w6TtrRt/defender-for-identity-download-sensors.png","url":"https://go.microsoft.com/fwlink/?linkid=2058038"},"type":"IMAGE"},"8":{"data":{"targetOption":"_blank","height":"auto","width":"auto","alignment":"none","alt":"Microsoft Defender for Identity Sensor Install Choose Language","src":"https://i.ibb.co/BBV6hs7/Microsoft-Defender-for-Identity-Sensor-Install-Choose-Language.png","url":"https://go.microsoft.com/fwlink/?linkid=2058038"},"mutability":"MUTABLE","type":"IMAGE"},"9":{"data":{"width":"auto","src":"https://i.ibb.co/xgVRBHc/Microsoft-Defender-for-Identity-Sensor-Install-Deployment-Type.png","alt":"Microsoft Defender for Identity Sensor Install Deployment Type","url":"https://go.microsoft.com/fwlink/?linkid=2058038","alignment":"none","height":"auto","targetOption":"_blank"},"type":"IMAGE","mutability":"MUTABLE"},"10":{"mutability":"MUTABLE","data":{"width":"auto","alt":"Microsoft Defender for Identity Sensor Install Configure the Sensor","url":"https://go.microsoft.com/fwlink/?linkid=2058038","alignment":"none","targetOption":"_blank","src":"https://i.ibb.co/DzKrx0z/Microsoft-Defender-for-Identity-Sensor-Install-Configure-the-Sensor.png","height":"auto"},"type":"IMAGE"},"11":{"mutability":"MUTABLE","type":"IMAGE","data":{"src":"https://i.ibb.co/FzXLp2J/defender-for-identity-DCs.png","targetOption":"_blank","alignment":"none","height":"auto","width":"auto","alt":"Defender for Identity DCs with Sensor installed","url":"https://go.microsoft.com/fwlink/?linkid=2058038"}},"12":{"data":{"src":"https://i.ibb.co/F5dcMLV/AD-Properties.png","_map":{"mutability":"MUTABLE","data":{"title":"<span data-offset-key=\"56vuh-1-0\" style=\"box-sizing: border-box; font-weight: bold;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Open</span></span>","url":"https://portal.atp.azure.com/","targetOption":"_blank"},"type":"LINK"},"height":"auto","targetOption":"_blank","alignment":"left","url":"https://portal.atp.azure.com/","width":"auto","title":"<span data-offset-key=\"56vuh-1-0\" style=\"box-sizing: border-box; font-weight: bold;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Open</span></span>","alt":"Open domain properties"},"type":"LINK","mutability":"MUTABLE"},"13":{"mutability":"MUTABLE","data":{"alignment":"none","url":"https://go.microsoft.com/fwlink/?linkid=2058038","targetOption":"_blank","alt":"Microsoft Defender for Identity Delayed updated","width":"auto","height":"auto","src":"https://i.ibb.co/KhQT36Y/delay-updates.png"},"type":"IMAGE"},"14":{"data":{"width":"auto","alignment":"none","targetOption":"_blank","url":"https://go.microsoft.com/fwlink/?linkid=2058038","height":"auto","alt":"Open domain properties","src":"https://i.ibb.co/F5dcMLV/AD-Properties.png"},"mutability":"MUTABLE","type":"IMAGE"},"15":{"data":{"height":"auto","alt":"Add advanced permissions","alignment":"none","targetOption":"_blank","url":"https://go.microsoft.com/fwlink/?linkid=2058038","src":"https://i.ibb.co/375P8GM/Add-Advanced-Permissions.png","width":"auto"},"mutability":"MUTABLE","type":"IMAGE"},"16":{"data":{"width":"auto","alt":"Select a principal","targetOption":"_blank","src":"https://i.ibb.co/MkCvDqj/select-a-principal.png","url":"https://go.microsoft.com/fwlink/?linkid=2058038","alignment":"none","height":"auto"},"mutability":"MUTABLE","type":"IMAGE"},"17":{"mutability":"MUTABLE","type":"IMAGE","data":{"url":"https://go.microsoft.com/fwlink/?linkid=2058038","alignment":"none","height":"auto","alt":"Applies to","width":"auto","targetOption":"_blank","src":"https://i.ibb.co/7jsFRLc/Applies-to.png"}},"18":{"mutability":"MUTABLE","data":{"height":"auto","src":"https://i.ibb.co/vvjdwDy/User-Permissions.png","width":"auto","targetOption":"_blank","alt":"User Permissions","url":"https://go.microsoft.com/fwlink/?linkid=2058038","alignment":"none"},"type":"IMAGE"},"19":{"mutability":"MUTABLE","type":"IMAGE","data":{"targetOption":"_blank","alignment":"none","height":"auto","alt":"Group objects","width":"auto","src":"https://i.ibb.co/YbPw0Zc/group-objects.png","url":"https://go.microsoft.com/fwlink/?linkid=2058038"}},"20":{"mutability":"MUTABLE","type":"IMAGE","data":{"width":"auto","targetOption":"_blank","alt":"Group permissions","src":"https://i.ibb.co/T2bgwNJ/group-permissions.png","height":"auto","alignment":"none","url":"https://go.microsoft.com/fwlink/?linkid=2058038"}},"21":{"type":"LINK","data":{"alignment":"left","height":"auto","alt":"Open Microsoft Defender for Cloud Apps","url":"https://security.microsoft.com/settings/identities?tabid=manageAccounts","width":"auto","targetOption":"_blank","src":"https://i.ibb.co/ZXQX5Rd/Open-Microsoft-Defender-for-Cloud-Apps.png"},"mutability":"MUTABLE"},"22":{"type":"IMAGE","mutability":"MUTABLE","data":{"url":"https://go.microsoft.com/fwlink/?linkid=2058038","height":"auto","src":"https://i.ibb.co/8sSxWZV/add-credentials-for-action-accounts.png","alignment":"none","alt":"Add credentials for action accounts","width":"auto","targetOption":"_blank"}},"23":{"type":"LINK","mutability":"MUTABLE","data":{"title":"<span data-offset-key=\"74h3g-1-0\" style=\"box-sizing: border-box; font-weight: bold;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Sensitive</span></span>","targetOption":"_blank","url":"https://security.microsoft.com/settings/identities?tabid=entityTagsSensitive","_map":{"type":"LINK","mutability":"MUTABLE","data":{"targetOption":"_blank","url":"https://security.microsoft.com/settings/identities?tabid=entityTagsSensitive","title":"<span data-offset-key=\"74h3g-1-0\" style=\"box-sizing: border-box; font-weight: bold;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Sensitive</span></span>"}},"width":"auto","alignment":"left","height":"auto","src":"https://i.ibb.co/ZXQX5Rd/Open-Microsoft-Defender-for-Cloud-Apps.png","alt":"Open Microsoft Defender for Cloud Apps"}},"24":{"type":"IMAGE","data":{"_map":{"data":{"title":"<span data-offset-key=\"74h3g-1-0\" style=\"box-sizing: border-box; font-weight: bold;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Sensitive</span></span>","url":"https://security.microsoft.com/settings/identities?tabid=entityTagsSensitive","targetOption":"_blank"},"mutability":"MUTABLE","type":"LINK"},"height":"auto","alignment":"none","width":"auto","url":"https://go.microsoft.com/fwlink/?linkid=2058038","src":"https://i.ibb.co/9nC0B4Z/tag-sensitive-accounts.png","targetOption":"_blank","alt":"Tag sensitive accounts","title":"<span data-offset-key=\"74h3g-1-0\" style=\"box-sizing: border-box; font-weight: bold;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Sensitive</span></span>"},"mutability":"MUTABLE"},"25":{"data":{"src":"https://i.ibb.co/s58V9jq/honeytoken-account-creation.png","targetOption":"_blank","alt":"Honeytoken account creation","title":"<span data-offset-key=\"74h3g-1-0\" style=\"box-sizing: border-box; font-weight: bold;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Sensitive</span></span>","url":"https://security.microsoft.com/settings/identities?tabid=entityTagsHoneytoken","_map":{"mutability":"MUTABLE","data":{"title":"<span data-offset-key=\"74h3g-1-0\" style=\"box-sizing: border-box; font-weight: bold;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Sensitive</span></span>","targetOption":"_blank","url":"https://security.microsoft.com/settings/identities?tabid=entityTagsSensitive"},"type":"LINK"},"alignment":"none","height":"auto","width":"auto"},"type":"IMAGE","mutability":"MUTABLE"},"26":{"data":{"width":"auto","height":"auto","alignment":"left","src":"https://i.ibb.co/ZXQX5Rd/Open-Microsoft-Defender-for-Cloud-Apps.png","alt":"Open Microsoft Defender for Cloud Apps","targetOption":"_blank","url":"https://security.microsoft.com/settings/identities?tabid=entityTagsHoneytoken"},"type":"LINK","mutability":"MUTABLE"},"27":{"mutability":"MUTABLE","type":"IMAGE","data":{"targetOption":"_blank","alt":"Honeytoken account setup","alignment":"none","height":"auto","width":"auto","src":"https://i.ibb.co/3cFcT2J/honeytoken-account-setup.png","url":"https://go.microsoft.com/fwlink/?linkid=2058038"}},"28":{"data":{"src":"https://i.ibb.co/ZXQX5Rd/Open-Microsoft-Defender-for-Cloud-Apps.png","alt":"Open Microsoft Defender for Cloud Apps","height":"auto","width":"auto","url":"https://go.microsoft.com/fwlink/?linkid=2058038","alignment":"left","targetOption":"_blank"},"type":"LINK","mutability":"MUTABLE"},"29":{"data":{"src":"https://i.ibb.co/ZXQX5Rd/Open-Microsoft-Defender-for-Cloud-Apps.png","alignment":"none","height":"auto","width":"auto","alt":"Open Microsoft Defender for Cloud Apps","url":"https://portal.atp.azure.com/configuration?tab=wdatp","targetOption":"_blank"},"mutability":"MUTABLE","type":"IMAGE"},"30":{"data":{"src":"https://i.ibb.co/f0NNnnb/Defender-for-Cloud-Apps-integration-with-Defender-for-Identity.png","width":"auto","height":"auto","targetOption":"_blank","alignment":"none","alt":"Integrate Defender for Cloud Apps with Defender for Identity","url":"https://portal.atp.azure.com/configuration?tab=wdatp"},"type":"IMAGE","mutability":"MUTABLE"},"31":{"type":"LINK","mutability":"MUTABLE","data":{"url":"https://portal.atp.azure.com/configuration?tab=wdatp","targetOption":"_blank","alt":"Enable Integration Between Defender for Endpoint and Defender for Identity","alignment":"left","height":"auto","src":"https://i.ibb.co/qW4W1SS/Enable-Integration-Between-Defender-for-Endpoint-and-Defender-for-Identity.png","width":"auto"}},"32":{"type":"IMAGE","data":{"alt":"Enable Integration Between Defender for Endpoint and Defender for Identity","height":"auto","targetOption":"_blank","url":"https://security.microsoft.com/preferences2/integration","alignment":"none","width":"auto","src":"https://i.ibb.co/qW4W1SS/Enable-Integration-Between-Defender-for-Endpoint-and-Defender-for-Identity.png"},"mutability":"MUTABLE"},"33":{"type":"LINK","mutability":"MUTABLE","data":{"url":"https://security.microsoft.com/preferences2/integration","alt":"Enable Defender for Identity and endpoint integration","alignment":"left","height":"auto","targetOption":"_blank","src":"https://i.ibb.co/WkvGhbd/Enable-Defender-for-Identity-and-endpoint-integration.png","width":"auto"}},"34":{"type":"IMAGE","mutability":"MUTABLE","data":{"height":"auto","alignment":"none","src":"https://i.ibb.co/WkvGhbd/Enable-Defender-for-Identity-and-endpoint-integration.png","targetOption":"_blank","width":"auto","alt":"Enable Defender for Identity and endpoint integration","url":"https://portal.atp.azure.com/timeline?status=Open&severity=All"}},"35":{"type":"LINK","data":{"alignment":"left","width":"auto","alt":"Defender for Identity timeline","src":"https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png","height":"auto","title":"<span data-offset-key=\"c2shm-1-0\" style=\"box-sizing: border-box;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Microsoft Defender for Identity admin center</span></span>","_map":{"mutability":"MUTABLE","type":"LINK","data":{"title":"<span data-offset-key=\"c2shm-1-0\" style=\"box-sizing: border-box;\"><span data-text=\"true\" style=\"box-sizing: border-box;\">Microsoft Defender for Identity admin center</span></span>","url":"https://portal.atp.azure.com/","targetOption":"_blank"}},"targetOption":"_blank","url":"https://docs.microsoft.com/en-us/defender-for-identity/configure-port-mirroring"},"mutability":"MUTABLE"},"36":{"type":"LINK","data":{"width":"auto","alignment":"left","alt":"Defender for Identity timeline","targetOption":"_blank","height":"auto","_map":{"mutability":"MUTABLE","data":{"alt":"Microsoft Defender for identity sensors","width":"auto","height":"auto","src":"https://i.ibb.co/w6TtrRt/defender-for-identity-download-sensors.png"},"type":"IMAGE"},"url":"https://docs.microsoft.com/en-us/defender-for-identity/install-step6-vpn#configure-radius-accounting-on-the-vpn-system","src":"https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png"},"mutability":"MUTABLE"},"37":{"data":{"url":"https://docs.microsoft.com/en-us/defender-for-identity/install-step6-vpn#configure-vpn-in-defender-for-identity","alt":"Defender for Identity timeline","targetOption":"_blank","height":"auto","alignment":"left","src":"https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png","width":"auto"},"type":"LINK","mutability":"MUTABLE"},"38":{"type":"LINK","data":{"alignment":"left","height":"auto","alt":"Defender for Identity timeline","src":"https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png","url":"https://docs.microsoft.com/en-us/defender-for-identity/install-step6-vpn#configure-vpn-in-defender-for-identity","width":"auto","targetOption":"_blank"},"mutability":"MUTABLE"},"39":{"mutability":"MUTABLE","data":{"width":"auto","height":"auto","src":"https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png","url":"https://portal.atp.azure.com/timeline?status=Open&severity=All","targetOption":"_blank","alignment":"none","alt":"Defender for Identity timeline"},"type":"IMAGE"},"40":{"mutability":"MUTABLE","data":{"alt":"Honeytoken breach in Microsoft defender admin center","alignment":"left","src":"https://i.ibb.co/G9qzFPn/Honeytoken-breach-in-microsoft-defender.png","url":"https://portal.atp.azure.com/timeline?status=Open&severity=All","targetOption":"_blank","height":"auto","width":"auto"},"type":"LINK"},"41":{"data":{"height":"auto","alt":"Honeytoken breach in Microsoft defender admin center","width":"auto","alignment":"none","src":"https://i.ibb.co/G9qzFPn/Honeytoken-breach-in-microsoft-defender.png"},"type":"IMAGE","mutability":"MUTABLE"},"42":{"data":{"alt":"Defender for Cloud Apps alerts","height":"auto","src":"https://i.ibb.co/nbDKcWs/Defender-for-Cloud-Apps-Alerts.png","alignment":"none","width":"auto"},"type":"IMAGE","mutability":"MUTABLE"}},"blocks":[{"data":{},"depth":0,"text":"Microsoft Defender for Identity is designed to protect your on-premises Active Directory (AD) and Active Directory Federation Services (ADFS). Microsoft Defender for Identity can perform the following:","type":"unstyled","entityRanges":[],"key":"a1lah","inlineStyleRanges":[]},{"inlineStyleRanges":[],"key":"bi989","depth":0,"type":"unordered-list-item","entityRanges":[],"text":"Monitor user and entity behavior/activities with intelligent analytics.","data":{}},{"entityRanges":[],"depth":0,"data":{},"type":"unordered-list-item","text":"Protect user identities and reduces the attack surface.","key":"3gd3f","inlineStyleRanges":[]},{"type":"unordered-list-item","entityRanges":[],"key":"6mp32","data":{},"inlineStyleRanges":[],"text":"Identify and investigate suspicious user activities to find advanced attacks throughout your environment.","depth":0},{"type":"unordered-list-item","key":"6nhoe","depth":0,"inlineStyleRanges":[],"data":{},"entityRanges":[],"text":"Use the Microsoft 365 portal to monitor and respond to investigate alerts and user activity."},{"key":"dg65b","data":{},"inlineStyleRanges":[],"depth":0,"entityRanges":[],"text":"How does Microsoft Defender for Identity work?","type":"header-two"},{"type":"unstyled","key":"caiku","data":{},"depth":0,"inlineStyleRanges":[],"entityRanges":[],"text":"Microsoft Defender for Identity monitors your domain controllers' network traffic and event logs. It then uses this information to detect attacks and threats. Microsoft Defender for Identity gathers the information and analyzes it based on user and device behavior. But what's the flow?"},{"inlineStyleRanges":[],"entityRanges":[],"data":{},"key":"8ta48","text":"In short, you install a sensor on your AD FS servers and domain controllers. The sensor will send the network traffic, Windows events, and traces back to Microsoft Defender for Identity that's in the Microsoft 365 cloud. Microsoft Defender for Identity will send the information to the Microsoft Defender for Cloud Apps portal and show you the activities, and alerts.","type":"unstyled","depth":0},{"entityRanges":[],"depth":0,"key":"apgf3","data":{},"text":"But don't worry. Microsoft won't use your data for advertising or anything else other than providing you the defense your organization needs.","type":"unstyled","inlineStyleRanges":[{"style":"ITALIC","offset":0,"length":141}]},{"key":"ej9d2","data":{},"entityRanges":[],"depth":0,"inlineStyleRanges":[],"type":"header-two","text":"What licenses will give us Microsoft Defender for Identity?"},{"entityRanges":[],"key":"5vl13","depth":0,"inlineStyleRanges":[],"data":{},"type":"unstyled","text":"Microsoft Defender for Identity is part of the Enterprise Mobility + Security 5 (EMS E5) and as a standalone license."},{"key":"96iem","text":"How do you set up Microsoft Defender for Identity?","entityRanges":[],"inlineStyleRanges":[],"data":{},"type":"header-two","depth":0},{"key":"1c0a7","entityRanges":[],"data":{},"text":"There are a couple of steps to set up the Microsoft Defender for Identity. In short, we'll need to configure Defender for Identity and then install the sensor on your AD servers. After that, we'll need to configure the account for automatic actions. Then we'll need to set up the sensitive accounts and honey token accounts. Next, we'll enable the integration between Defender for Identity and Defender for Cloud Apps, as well as, Defender for Endpoint. Then you'll need to review the reports and Secure Score to improve the security of your environment. Finally, you'll need to monitor the alerts.","type":"unstyled","inlineStyleRanges":[],"depth":0},{"entityRanges":[],"key":"76vrb","inlineStyleRanges":[],"depth":0,"text":"How to configure Microsoft Defender for Identity","data":{},"type":"header-three"},{"type":"unstyled","depth":0,"text":"1. Go to the Microsoft 365 Defender portal > More resources > Click Open located under Azure Advanced Threat Protection.","inlineStyleRanges":[{"length":29,"offset":13,"style":"BOLD"},{"length":14,"style":"BOLD","offset":45},{"offset":68,"length":4,"style":"BOLD"},{"offset":87,"style":"BOLD","length":32}],"entityRanges":[{"key":0,"offset":68,"length":4}],"data":{},"key":"56vuh"},{"inlineStyleRanges":[],"text":" ","depth":0,"entityRanges":[{"length":1,"offset":0,"key":1}],"key":"e8oci","data":{},"type":"atomic"},{"key":"6ps7e","depth":0,"text":" 2. If you receive the Welcome screen click Create.","type":"unstyled","inlineStyleRanges":[{"style":"BOLD","offset":44,"length":6}],"entityRanges":[{"offset":0,"length":1,"key":2}],"data":{}},{"inlineStyleRanges":[],"key":"70iu0","depth":0,"data":{},"type":"atomic","entityRanges":[{"offset":0,"key":3,"length":1}],"text":" "},{"type":"unstyled","key":"8gum2","data":{},"inlineStyleRanges":[{"length":13,"offset":9,"style":"BOLD"},{"style":"BOLD","length":18,"offset":25}],"entityRanges":[],"depth":0,"text":"3. Click configuration > Directory services."},{"entityRanges":[],"key":"2s1pp","text":"4. Open PowerShell on your domain controller. Run the following script:","inlineStyleRanges":[{"length":11,"style":"BOLD","offset":8}],"data":{},"depth":0,"type":"unstyled"},{"key":"5nm4n","type":"code","data":{},"depth":0,"entityRanges":[],"inlineStyleRanges":[],"text":"Import-Module ActiveDirectory\nif ((Get-KdsRootKey) -eq $null) {\n     Add-KdsRootKey -EffectiveImmediately\n     Write-Host \"Please wait 10 hours and then run this script again\"\n} else {\n     $DomainControllers = Get-ADDomainController\n     $Dcs = @()\n     foreach ($DomainController in $DomainControllers) {\n          $Dcs += \"$($DomainController.Name)$\"\n     }\n     new-adserviceaccount -name gMSA01 -dnshostname ((Get-DnsServer).ServerSetting.ComputerName) -PrincipalsAllowedToRetrieveManagedPassword $Dcs\n}"},{"depth":0,"data":{},"text":"5. If you receive the message \"Please wait 10 hours and then run this script again\" wait 10 hours then run the script again.","type":"unstyled","entityRanges":[],"key":"f5vpj","inlineStyleRanges":[{"offset":31,"style":"BOLD","length":51}]},{"inlineStyleRanges":[{"length":6,"offset":25,"style":"BOLD"},{"style":"BOLD","length":29,"offset":43},{"length":11,"offset":85,"style":"BOLD"},{"style":"BOLD","offset":126,"length":4}],"depth":0,"key":"8n1bk","data":{},"type":"unstyled","text":"6. Enter the username of gMSA01. Click the Group managed service account. Enter your domain name in the space provided. Click Save.","entityRanges":[]},{"data":{},"type":"atomic","inlineStyleRanges":[],"depth":0,"entityRanges":[{"offset":0,"length":1,"key":4}],"text":" ","key":"a8t54"},{"depth":0,"data":{},"inlineStyleRanges":[],"text":"How to install the sensor on your AD servers","key":"aia1i","type":"header-three","entityRanges":[{"key":5,"offset":6,"length":1}]},{"depth":0,"key":"c2shm","text":"1. Open the Microsoft Defender for Identity admin center.","data":{},"entityRanges":[{"offset":12,"key":6,"length":44}],"inlineStyleRanges":[],"type":"unstyled"},{"data":{},"type":"unstyled","text":"2. Click Configuration > Sensors.","entityRanges":[],"key":"3ohok","depth":0,"inlineStyleRanges":[{"length":13,"offset":9,"style":"BOLD"},{"length":7,"style":"BOLD","offset":25}]},{"text":" ","inlineStyleRanges":[],"entityRanges":[{"key":7,"offset":0,"length":1}],"depth":0,"data":{},"key":"2qigp","type":"atomic"},{"depth":0,"text":"3. Click Download. Save the zip to your computer.","type":"unstyled","entityRanges":[],"data":{},"inlineStyleRanges":[{"length":8,"offset":9,"style":"BOLD"}],"key":"68cc3"},{"data":{},"type":"unstyled","entityRanges":[],"text":"4. Copy the zip file to one of your domain controllers.","inlineStyleRanges":[],"depth":0,"key":"7agok"},{"entityRanges":[],"inlineStyleRanges":[],"key":"7es2b","data":{},"type":"unstyled","text":"5. Extract the zip.","depth":0},{"key":"mclj","depth":0,"entityRanges":[],"data":{},"inlineStyleRanges":[{"style":"BOLD","length":26,"offset":7}],"type":"unstyled","text":"6. Run Azure ATP Sensor Setup.exe"},{"key":"97ftb","data":{},"inlineStyleRanges":[{"offset":68,"style":"BOLD","length":4}],"entityRanges":[],"type":"unstyled","depth":0,"text":"7. On the Install Microsoft Defender for Identity Sensor page click Next."},{"type":"atomic","key":"am8d0","inlineStyleRanges":[],"data":{},"entityRanges":[{"length":1,"offset":0,"key":8}],"depth":0,"text":" "},{"data":{},"key":"31i1b","entityRanges":[],"depth":0,"inlineStyleRanges":[{"style":"BOLD","offset":44,"length":4}],"type":"unstyled","text":"8. On the Sensor deployment type page click Next."},{"inlineStyleRanges":[],"type":"atomic","depth":0,"data":{},"key":"5jelh","entityRanges":[{"length":1,"offset":0,"key":9}],"text":" "},{"key":"3jcra","data":{},"depth":0,"text":"9. Go back to the Defender for Identity admin center sensory web page and copy the Access key. Paste the access key into the Configure the Sensor page. Click Install.","entityRanges":[],"type":"unstyled","inlineStyleRanges":[{"length":5,"offset":74,"style":"BOLD"},{"style":"BOLD","length":6,"offset":95},{"style":"BOLD","length":7,"offset":158}]},{"inlineStyleRanges":[],"key":"41qgg","entityRanges":[{"key":10,"length":1,"offset":0}],"data":{},"text":" ","depth":0,"type":"atomic"},{"text":"10. Click Finish.","type":"unstyled","key":"eclg","entityRanges":[],"inlineStyleRanges":[],"depth":0,"data":{}},{"type":"unstyled","text":"11. Repeat steps 4-10 on each domain controller.","depth":0,"data":{},"inlineStyleRanges":[],"key":"51gpr","entityRanges":[]},{"entityRanges":[],"type":"unstyled","inlineStyleRanges":[{"offset":175,"style":"BOLD","length":7}],"text":"12. Once the sensor is installed on all of your domain controllers refresh the Defender for Identity Sensors web page and verify the DCs appear in the list with the status of Running.","key":"p44m","depth":0,"data":{}},{"text":" ","inlineStyleRanges":[],"depth":0,"type":"atomic","data":{},"entityRanges":[{"key":11,"offset":0,"length":1}],"key":"fbv8t"},{"key":"111k9","inlineStyleRanges":[],"text":"Configure Delayed updates","entityRanges":[],"data":{},"type":"header-three","depth":0},{"key":"6vu6o","entityRanges":[],"type":"unstyled","depth":0,"data":{},"inlineStyleRanges":[],"text":"Now that we have the software installed there's one configuration option you should know. Delayed updates give you the ability to set the Defender for Identity to delay installing updates by 72 hours. Typically, Microsoft will release updates for the sensor a couple of times a month. By setting the delay to 72 hours you may be a little bit behind but you'll be less likely to have a negative impact due to an update being misconfigured."},{"data":{},"inlineStyleRanges":[{"style":"color-rgb(33,37,41)","offset":3,"length":117},{"offset":3,"style":"bgcolor-rgb(255,255,255)","length":117},{"length":117,"offset":3,"style":"fontsize-16"},{"style":"fontfamily-system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", \"Liberation Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji","length":117,"offset":3},{"style":"BOLD","length":29,"offset":13},{"style":"BOLD","offset":45,"length":14},{"offset":68,"length":4,"style":"BOLD"},{"style":"BOLD","length":32,"offset":87},{"length":4,"offset":68,"style":"color-rgb(13,110,253)"},{"offset":68,"length":4,"style":"UNDERLINE"}],"depth":0,"entityRanges":[{"length":4,"key":12,"offset":68}],"key":"9egri","type":"unstyled","text":"1. Go to the Microsoft 365 Defender portal > More resources > Click Open located under Azure Advanced Threat Protection."},{"depth":0,"text":"2. Click Settings in the left nav > Updates. Click the Delayed update switch to On. Click Save.","inlineStyleRanges":[{"length":95,"offset":0,"style":"color-rgb(33,37,41)"},{"length":95,"style":"bgcolor-rgb(255,255,255)","offset":0},{"offset":0,"length":95,"style":"fontsize-16"},{"offset":0,"style":"fontfamily-system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", \"Liberation Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji","length":95},{"style":"BOLD","length":9,"offset":9},{"style":"BOLD","length":7,"offset":36},{"style":"BOLD","length":2,"offset":80},{"style":"BOLD","offset":90,"length":4}],"key":"f56r0","data":{},"type":"unstyled","entityRanges":[]},{"entityRanges":[{"length":1,"offset":0,"key":13}],"data":{},"inlineStyleRanges":[],"text":" ","depth":0,"key":"ag9ch","type":"atomic"},{"inlineStyleRanges":[],"type":"header-two","key":"95jof","text":"Configure Automatic Actions","depth":0,"entityRanges":[],"data":{}},{"data":{},"text":"In these steps, we'll set up the group account we created earlier to perform automatic actions in our AD domain.","inlineStyleRanges":[],"entityRanges":[],"key":"al03g","depth":0,"type":"unstyled"},{"depth":0,"key":"4rndu","data":{},"entityRanges":[],"inlineStyleRanges":[{"style":"BOLD","length":36,"offset":8},{"style":"BOLD","length":7,"offset":62},{"style":"BOLD","offset":79,"length":10}],"type":"unstyled","text":"1. Open Active Directory Users and Computers. Right-click the domain and click Properties."},{"data":{},"inlineStyleRanges":[],"entityRanges":[{"length":1,"offset":0,"key":14}],"depth":0,"type":"atomic","key":"b4lit","text":" "},{"text":"2. Click the Security tab > Advanced > Add.","key":"b1b2s","depth":0,"type":"unstyled","inlineStyleRanges":[{"style":"BOLD","offset":13,"length":9},{"offset":28,"length":9,"style":"BOLD"},{"style":"BOLD","length":3,"offset":39}],"data":{},"entityRanges":[]},{"data":{},"text":" ","entityRanges":[{"offset":0,"length":1,"key":15}],"depth":0,"type":"atomic","key":"2u9s0","inlineStyleRanges":[]},{"data":{},"entityRanges":[],"text":"3. Click Select a principal. Click Object Types > Service Accounts > OK. Enter gMSA01 in the object name to select box. Click OK.","key":"aqep6","inlineStyleRanges":[{"length":18,"style":"BOLD","offset":9},{"length":12,"offset":35,"style":"BOLD"},{"length":16,"offset":50,"style":"BOLD"},{"style":"BOLD","offset":69,"length":2},{"style":"BOLD","length":6,"offset":79},{"style":"BOLD","length":2,"offset":126}],"depth":0,"type":"unstyled"},{"type":"atomic","key":"6rnns","entityRanges":[{"key":16,"offset":0,"length":1}],"text":" ","depth":0,"data":{},"inlineStyleRanges":[]},{"data":{},"inlineStyleRanges":[{"style":"BOLD","offset":13,"length":10},{"style":"BOLD","length":22,"offset":42}],"type":"unstyled","entityRanges":[],"depth":0,"text":"4. Click the Applies to drop down. Select Descendant User object.","key":"adv7t"},{"data":{},"text":" ","key":"69u1p","inlineStyleRanges":[],"depth":0,"type":"atomic","entityRanges":[{"length":1,"offset":0,"key":17}]},{"entityRanges":[],"depth":0,"data":{},"type":"unstyled","text":"5. To enable force password reset click Permissions: Reset password. Then click Properties: Read pwdLastSet & Properties: Write pwdLastSet","inlineStyleRanges":[{"length":27,"offset":40,"style":"BOLD"},{"style":"BOLD","offset":80,"length":27},{"length":28,"offset":110,"style":"BOLD"}],"key":"fdcsf"},{"data":{},"depth":0,"inlineStyleRanges":[{"offset":59,"style":"BOLD","length":35},{"offset":97,"style":"BOLD","length":36}],"type":"unstyled","entityRanges":[],"key":"864hl","text":"6. To grant the account the ability to disable users click Properties: Read userAccountControl & Properties: Write userAccountControl"},{"data":{},"inlineStyleRanges":[],"type":"atomic","key":"bqm2q","text":" ","depth":0,"entityRanges":[{"offset":0,"key":18,"length":1}]},{"text":"8. Click OK.","depth":0,"type":"unstyled","key":"749p0","entityRanges":[],"inlineStyleRanges":[{"length":2,"offset":9,"style":"BOLD"}],"data":{}},{"text":"7. Click Add > Select a principal. Enter GMSA01 in the name field again and click OK. Click the Applies to dropdown. Then click Descendant Group objects.","data":{},"entityRanges":[],"depth":0,"inlineStyleRanges":[{"length":3,"style":"BOLD","offset":9},{"style":"BOLD","length":18,"offset":15},{"length":6,"offset":41,"style":"BOLD"},{"style":"BOLD","offset":82,"length":2},{"length":10,"offset":96,"style":"BOLD"},{"length":24,"style":"BOLD","offset":128}],"key":"5smmj","type":"unstyled"},{"depth":0,"inlineStyleRanges":[],"text":" ","entityRanges":[{"key":19,"length":1,"offset":0}],"data":{},"key":"8oh23","type":"atomic"},{"entityRanges":[],"key":"6hem5","depth":0,"data":{},"type":"unstyled","text":"8. Click Properties: Read Members & Properties: Write Members.","inlineStyleRanges":[{"style":"BOLD","length":24,"offset":9},{"offset":36,"style":"BOLD","length":25}]},{"type":"atomic","entityRanges":[{"key":20,"length":1,"offset":0}],"inlineStyleRanges":[],"key":"9rg68","depth":0,"data":{},"text":" "},{"data":{},"text":"9. Click OK. Click Apply > OK.","key":"atlqp","inlineStyleRanges":[{"style":"BOLD","length":2,"offset":9},{"length":6,"style":"BOLD","offset":19},{"length":2,"style":"BOLD","offset":27}],"entityRanges":[],"depth":0,"type":"unstyled"},{"inlineStyleRanges":[],"depth":0,"type":"unstyled","data":{},"entityRanges":[{"key":21,"length":22,"offset":97}],"key":"6dqdu","text":"10. Go back to the Microsoft Defender admin center web page again. Click Settings > Identities > Manage action accounts. "},{"type":"unstyled","entityRanges":[],"data":{},"inlineStyleRanges":[{"style":"BOLD","length":15,"offset":10},{"length":6,"offset":51,"style":"BOLD"},{"length":20,"style":"BOLD","offset":82},{"style":"BOLD","length":4,"offset":110}],"key":"bbjn8","depth":0,"text":"11. Click Add credentials. Set the account name to gMSA01. Set the domain to your internal domain name. Click Save."},{"type":"atomic","entityRanges":[{"length":1,"key":22,"offset":0}],"text":" ","inlineStyleRanges":[],"key":"e1942","depth":0,"data":{}},{"data":{},"type":"header-three","entityRanges":[],"key":"brnr1","depth":0,"inlineStyleRanges":[],"text":"How to set up the sensitive accounts"},{"inlineStyleRanges":[],"depth":0,"text":"Sensitive accounts are typically C-level executives and administrator accounts. Administrator accounts and domain controllers are automatically added as sensitive accounts but we'll add them manually anyway. These accounts will require extra alerts and management by Defender for Identity.","type":"unstyled","entityRanges":[],"key":"iq6n","data":{}},{"entityRanges":[{"key":23,"length":9,"offset":68}],"key":"74h3g","type":"unstyled","data":{},"inlineStyleRanges":[{"length":31,"style":"BOLD","offset":9},{"style":"BOLD","length":9,"offset":43},{"length":11,"offset":54,"style":"BOLD"},{"offset":68,"style":"BOLD","length":9}],"depth":0,"text":"1. Go to Microsoft Defender admin center > Settings > Identitites > Sensitive."},{"inlineStyleRanges":[{"offset":9,"style":"BOLD","length":9},{"style":"BOLD","length":24,"offset":52},{"length":13,"offset":84,"style":"BOLD"}],"depth":0,"key":"2398p","data":{},"text":"2. Click Tag users. Click the check box next to the accounts you want to add. Click Add selection.","entityRanges":[],"type":"unstyled"},{"key":"7e0n9","entityRanges":[{"offset":0,"key":24,"length":1}],"data":{},"text":" ","type":"atomic","depth":0,"inlineStyleRanges":[]},{"type":"header-three","key":"8lcc4","depth":0,"entityRanges":[],"text":"How to set up honey token accounts","data":{},"inlineStyleRanges":[]},{"entityRanges":[],"inlineStyleRanges":[],"data":{},"key":"7roli","text":"Honey token accounts are accounts that are never used. They should never be logged into by anyone. When a malicious user accesses your environment and then uses that account in an attempt to gain elevated permissions then Defender for Identity will trigger alerts.","depth":0,"type":"unstyled"},{"text":"1. Create an account in your on-premises Active Directory Users and Computers. Name the account something like \"Gruber Admin\" that a malicious user would find and attempt to access.","key":"9nl71","type":"unstyled","entityRanges":[],"inlineStyleRanges":[],"data":{},"depth":0},{"data":{},"entityRanges":[{"length":1,"offset":0,"key":25}],"type":"atomic","inlineStyleRanges":[],"text":" ","key":"8sf9q","depth":0},{"key":"fpvh5","entityRanges":[],"data":{},"type":"unstyled","depth":0,"inlineStyleRanges":[{"length":90,"offset":0,"style":"color-rgb(33,37,41)"},{"length":90,"offset":0,"style":"bgcolor-rgb(255,255,255)"},{"style":"fontsize-16","length":90,"offset":0},{"offset":0,"style":"fontfamily-system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", \"Liberation Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji","length":90}],"text":"2. Wait until your on-premises AD syncs to Microsoft 365. Typically it takes about 1 hour."},{"key":"8k12i","depth":0,"text":"3. Go to Microsoft Defender admin center > Settings > Identities > Honeytoken.","type":"unstyled","data":{},"inlineStyleRanges":[{"length":78,"offset":0,"style":"color-rgb(33,37,41)"},{"style":"bgcolor-rgb(255,255,255)","offset":0,"length":78},{"style":"fontsize-16","offset":0,"length":78},{"style":"fontfamily-system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", \"Liberation Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji","offset":0,"length":78},{"style":"BOLD","length":31,"offset":9},{"style":"BOLD","offset":43,"length":9},{"style":"BOLD","offset":54,"length":10},{"length":10,"style":"BOLD","offset":67},{"style":"color-rgb(13,110,253)","length":10,"offset":67},{"length":10,"style":"UNDERLINE","offset":67}],"entityRanges":[{"offset":67,"key":26,"length":10}]},{"text":"4. Click Tag users. Select the honeytoken account you created in step 1. Click Add selection.","entityRanges":[],"inlineStyleRanges":[{"offset":0,"length":93,"style":"color-rgb(33,37,41)"},{"length":93,"offset":0,"style":"bgcolor-rgb(255,255,255)"},{"style":"fontsize-16","offset":0,"length":93},{"length":93,"style":"fontfamily-system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", \"Liberation Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji","offset":0},{"style":"BOLD","offset":9,"length":9},{"offset":20,"style":"BOLD","length":29},{"length":13,"style":"BOLD","offset":79}],"data":{},"depth":0,"type":"unstyled","key":"2vcmb"},{"inlineStyleRanges":[],"text":" ","entityRanges":[{"key":27,"length":1,"offset":0}],"depth":0,"data":{},"type":"atomic","key":"6148u"},{"key":"ceu3t","inlineStyleRanges":[],"entityRanges":[],"type":"header-three","depth":0,"text":"Enable Microsoft Defender for Identity data integration into Microsoft Defender for Cloud Apps","data":{}},{"text":"1. Open Microsoft Defender portal > More resources > Microsoft Defender for Cloud Apps.","key":"4c2op","entityRanges":[{"length":33,"key":28,"offset":53}],"depth":0,"type":"unstyled","data":{},"inlineStyleRanges":[]},{"type":"atomic","depth":0,"data":{},"text":" ","inlineStyleRanges":[],"entityRanges":[{"offset":0,"key":29,"length":1}],"key":"4p605"},{"text":"2. Click the gear in the top right corner > Settings > Microsoft Defender for Identity. Check the Enable Microsoft Defender for Identity integration. Click Save.","depth":0,"inlineStyleRanges":[{"offset":13,"length":5,"style":"BOLD"},{"style":"BOLD","length":9,"offset":44},{"offset":55,"style":"BOLD","length":31},{"length":50,"style":"BOLD","offset":98},{"style":"BOLD","offset":156,"length":4}],"type":"unstyled","data":{},"entityRanges":[],"key":"1a9cg"},{"entityRanges":[{"length":1,"offset":0,"key":30}],"inlineStyleRanges":[],"key":"2espj","depth":0,"data":{},"text":" ","type":"atomic"},{"text":"Enable Microsoft Defender for Identity data integration into Microsoft Defender for Endpoint","inlineStyleRanges":[],"type":"header-two","key":"30kvg","entityRanges":[],"depth":0,"data":{}},{"text":"1. Go to Microsoft Defender for Identity admin center > Configuration > Microsoft Defender for Endpoint.","inlineStyleRanges":[{"style":"color-rgb(33,37,41)","offset":0,"length":104},{"length":104,"offset":0,"style":"bgcolor-rgb(255,255,255)"},{"length":104,"offset":0,"style":"fontsize-16"},{"style":"fontfamily-system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", \"Liberation Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji","length":104,"offset":0}],"type":"unstyled","key":"fhbla","data":{},"entityRanges":[{"key":31,"length":31,"offset":72}],"depth":0},{"inlineStyleRanges":[{"style":"color-rgb(33,37,41)","offset":0,"length":81},{"style":"bgcolor-rgb(255,255,255)","length":81,"offset":0},{"style":"fontsize-16","length":81,"offset":0},{"length":81,"style":"fontfamily-system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", \"Liberation Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji","offset":0},{"offset":20,"style":"BOLD","length":48},{"length":4,"offset":76,"style":"BOLD"}],"type":"unstyled","entityRanges":[],"depth":0,"key":"b8fh","data":{},"text":"2. Click On next to Integration with Microsoft Defender for Endpoint. Click Save."},{"depth":0,"key":"8q1u9","data":{},"text":" ","type":"atomic","inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":1,"key":32}]},{"key":"8f9ta","depth":0,"type":"unstyled","entityRanges":[{"length":17,"key":33,"offset":74}],"inlineStyleRanges":[{"style":"BOLD","offset":13,"length":35},{"offset":51,"style":"BOLD","length":8},{"style":"BOLD","length":10,"offset":62},{"style":"BOLD","length":17,"offset":74}],"text":"3. Go to the Microsoft 365 Defender admin center > Settings > Endpoints > Advanced Features.","data":{}},{"depth":0,"type":"unstyled","data":{},"entityRanges":[],"text":"4. Enable the Microsoft Defender for Identity integration setting. Click Save preferences.","key":"eejfp","inlineStyleRanges":[{"length":43,"offset":14,"style":"BOLD"},{"style":"BOLD","length":16,"offset":73}]},{"depth":0,"key":"a9fra","type":"atomic","entityRanges":[{"length":1,"offset":0,"key":34}],"text":" ","data":{},"inlineStyleRanges":[]},{"entityRanges":[],"text":"How to configure monitoring for a server that cannot connect to the internet","key":"fk9hr","depth":0,"inlineStyleRanges":[],"data":{},"type":"header-two"},{"depth":0,"inlineStyleRanges":[],"key":"583jb","data":{},"text":"Let's say you have two servers: Server1 and Server2. Server1 is a domain controller and can connect to the internet. Server2 is a member server and can't connect to the internet. How do we monitor Server2 using Microsoft Defender for Identity? With an event subscription and port mirroring!","type":"unstyled","entityRanges":[]},{"key":"3j2ea","depth":0,"text":"Install the sensor in standalone mode","type":"header-three","entityRanges":[],"data":{},"inlineStyleRanges":[]},{"depth":0,"key":"47rv8","text":"Here's another scenario you'll probably never see in real life but it may be on the test. Let's say you have 2 servers: server1 and server2. Server1 is a domain controller and can't connect to the internet. Server2 is a member server and can communicate with server1 and connect to the internet. How do you monitor server2 using the sensor?","type":"unstyled","entityRanges":[],"data":{},"inlineStyleRanges":[]},{"key":"8sdtq","text":"1. Install the standalone sensor on Server2","inlineStyleRanges":[],"entityRanges":[],"type":"unstyled","data":{},"depth":0},{"depth":0,"data":{},"type":"unstyled","key":"1ojrl","text":"2. Setup event subscription on Server2","entityRanges":[],"inlineStyleRanges":[]},{"key":"k19g","entityRanges":[{"key":35,"length":14,"offset":9}],"type":"unstyled","data":{},"text":"3. Setup port mirroring on Server1","inlineStyleRanges":[],"depth":0},{"depth":0,"entityRanges":[],"data":{},"text":"How to monitor VPN","inlineStyleRanges":[],"key":"ipht","type":"header-two"},{"type":"unstyled","text":"So now we're at another oddball. It's not very common so I won't go into details but you may see the question on the test. How do we integrate a VPN and Microsoft Defender for Identity?","inlineStyleRanges":[],"entityRanges":[],"key":"4h7e0","depth":0,"data":{}},{"inlineStyleRanges":[],"text":"Let's run through the scenario. Let's say you have a VPN server named VPN1 that runs Windows Server 2016 with the Remote Access role installed and configured. You have the Defender for Identity sensor installed on a Windows Server 2016 server named Server1. How do we integrate the VPN and Defender for Identity?","type":"unstyled","key":"9fi9p","depth":0,"data":{},"entityRanges":[]},{"inlineStyleRanges":[],"data":{},"entityRanges":[{"offset":13,"key":36,"length":17}],"type":"unstyled","depth":0,"key":"2tiht","text":"1. Configure RADIUS Accounting on VPN1"},{"depth":0,"key":"1251o","data":{},"entityRanges":[{"offset":10,"key":37,"length":21}],"inlineStyleRanges":[],"text":"2. Enable VPN / RADIUS Accounts in Defender for Identity","type":"unstyled"},{"depth":0,"data":{},"inlineStyleRanges":[],"text":"3. Enable inbound port 1813 on Server1","type":"unstyled","entityRanges":[{"offset":10,"key":38,"length":17}],"key":"f9bl4"},{"key":"dik79","entityRanges":[],"inlineStyleRanges":[],"depth":0,"data":{},"text":"How to integrate SIEM and Defender for identity","type":"header-two"},{"entityRanges":[],"data":{},"type":"unstyled","text":"Here's another oddball I won't go into detail but you may see it on the test. How and when do we integrate a third-party security information and event management (SIEM) solution and Defender for Identity?","inlineStyleRanges":[],"depth":0,"key":"a382e"},{"depth":0,"entityRanges":[],"key":"ek26j","text":"You'll need to integrate a SIEM and Defender for Identity when you're using a third-party SIEM solution and you want Defender for Identity to detect when sensitive groups are modified and when malicious services are created. In short, anytime you want Defender for Identity to alert when the SIEM solution picks up an issue.","type":"unstyled","data":{},"inlineStyleRanges":[]},{"key":"chtj7","inlineStyleRanges":[],"type":"unstyled","text":"How do you integrate a SIEM solution and Defender for Identity? By configuring event forwarding on the domain controllers / SIEM solution.","depth":0,"data":{},"entityRanges":[]},{"text":"How to monitor alerts","type":"header-two","key":"5t097","data":{},"depth":0,"inlineStyleRanges":[],"entityRanges":[]},{"inlineStyleRanges":[],"text":"The alerts will show up in a couple of different places. First, they'll show up in the Microsoft Defender for Identity Timeline. Next, they'll show up in the Microsoft Defender admin center Alerts & Investigation pages. Finally, they'll show up on the Microsoft Defender for Cloud Apps Alerts page.","data":{},"depth":0,"key":"dogph","type":"unstyled","entityRanges":[]},{"data":{},"text":"How to view alerts in the Microsoft Defender for Identity Timeline","entityRanges":[],"depth":0,"type":"header-three","inlineStyleRanges":[],"key":"df59m"},{"text":" ","key":"d5oo9","data":{},"entityRanges":[{"length":1,"key":39,"offset":0}],"type":"atomic","inlineStyleRanges":[],"depth":0},{"inlineStyleRanges":[{"length":44,"style":"BOLD","offset":9},{"style":"BOLD","length":8,"offset":56}],"type":"unstyled","depth":0,"text":"1. Go to Microsoft Defender for Identity admin center > Timeline.","data":{},"entityRanges":[{"key":40,"length":8,"offset":56}],"key":"dijtt"},{"key":"dtg0i","depth":0,"entityRanges":[],"type":"unstyled","data":{},"inlineStyleRanges":[],"text":"From there you'll see the suspicious activity in a timeline. You can click an alert to review more details about the issue. You can also click the ellipsis (...) next to an alert and close, suppress, or delete an alert."},{"inlineStyleRanges":[],"key":"ehcfa","depth":0,"type":"header-three","data":{},"entityRanges":[],"text":"How to view alerts in the Microsoft Defender admin center"},{"entityRanges":[{"length":1,"key":41,"offset":0}],"data":{},"type":"atomic","inlineStyleRanges":[],"depth":0,"key":"6lrfr","text":" "},{"depth":0,"text":"1. Open the Microsoft Defender admin center > Incidents & alerts > Incidents.","type":"unstyled","key":"djq5e","data":{},"inlineStyleRanges":[{"style":"BOLD","length":31,"offset":12},{"style":"BOLD","length":18,"offset":46},{"offset":67,"style":"BOLD","length":9}],"entityRanges":[]},{"inlineStyleRanges":[],"entityRanges":[],"text":"From there you can see the incidents. By clicking an incident name you can view more information, for example, the user and device that was used.","type":"unstyled","key":"c7vc3","depth":0,"data":{}},{"data":{},"text":"How to view alerts in the Microsoft Defender for Cloud Apps admin center","entityRanges":[],"type":"header-three","inlineStyleRanges":[],"key":"aqd9e","depth":0},{"depth":0,"data":{},"key":"c9fc4","text":" ","type":"atomic","inlineStyleRanges":[],"entityRanges":[{"offset":0,"key":42,"length":1}]},{"inlineStyleRanges":[{"style":"BOLD","length":46,"offset":12},{"length":6,"offset":61,"style":"BOLD"}],"text":"1. Open the Microsoft Defender for Cloud Apps admin center > Alerts.","depth":0,"data":{},"key":"7a9s8","type":"unstyled","entityRanges":[]}]},"slug":"Whats-Microsoft-Defender-for-identity-Kye_yNLxA","sectionId":"QScYfSu74","featuredImage":"https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png","publish":true},
      articles: [{"id":"cpchjBLkC","sectionId":"qwJW5VrBW","slug":"Whats-in-this-course-cpchjBLkC","title":"What's in this course?","featuredImage":"https://i.ibb.co/zFs9Vfb/microsoft365-security-administrator-associate-600x600.png"},{"id":"KKkBOVuS4","sectionId":"qwJW5VrBW","slug":"Creating-a-free-Microsoft-365-tenant-for-practice-KKkBOVuS4","title":"Creating a free Microsoft 365 tenant for practice","featuredImage":"https://i.ibb.co/F07sjQJ/microsoft-365-e5-trial.png"},{"id":"bzotoOjEe","sectionId":"qwJW5VrBW","slug":"Managing-the-Microsoft-365-tenant-Introduction-to-the-admin-centers-bzotoOjEe","title":"Managing the Microsoft 365 tenant - Introduction to the admin centers","featuredImage":"https://i.ibb.co/f1cr4zt/Microsoft-365-admin-centers.png"},{"id":"cg_vxOX9L","sectionId":"qwJW5VrBW","slug":"Managing-Microsoft-365-through-PowerShell-cg_vxOX9L","title":"Managing Microsoft 365 through PowerShell","featuredImage":"https://i.ibb.co/HV13YF6/install-microsoft-365-powershell-modules.png"},{"id":"uYCIPbnMC","sectionId":"AFV_acckJ","slug":"How-to-create-users-in-Microsoft-365-Cloud-Only-uYCIPbnMC","title":"How to create users in Microsoft 365 Cloud Only","featuredImage":"https://i.ibb.co/Wnt5Q43/View-Microsoft-365-Users.png"},{"id":"7CpqFkPZU","sectionId":"AFV_acckJ","slug":"Creating-and-managing-admins-through-roles-7CpqFkPZU","title":"Creating and managing admins through roles","featuredImage":"https://i.ibb.co/kySL4HQ/Roles-and-administrators.png"},{"id":"rZzausKJ1","sectionId":"AFV_acckJ","slug":"Time-limited-admin-roles-in-Microsoft-365-rZzausKJ1","title":"Time limited admin roles in Microsoft 365","featuredImage":"https://i.ibb.co/nDvjyPD/select-member-to-add-to-PIM-role.png"},{"id":"ky5W0Lz5P","sectionId":"AFV_acckJ","slug":"Whats-AD-Connect-ky5W0Lz5P","title":"What's AD Connect","featuredImage":"https://i.ibb.co/7nDqr9x/Whats-AD-Connect.png"},{"id":"i9pJIjTNH","sectionId":"AFV_acckJ","slug":"Protecting-Passwords-in-Microsoft-365-i9pJIjTNH","title":"Protecting Passwords in Microsoft 365","featuredImage":"https://i.ibb.co/DLD4G4q/access-smart-lockout-settings.png"},{"id":"S1hQgFOMV","sectionId":"AFV_acckJ","slug":"Creating-and-managing-users-through-groups-S1hQgFOMV","title":"Creating and managing users through groups","featuredImage":"https://i.ibb.co/nmmC28M/add-a-group-microsoft-365.png"},{"id":"2QfoI2HxY","sectionId":"AFV_acckJ","slug":"Securing-and-implementing-enterprise-applications-2QfoI2HxY","title":"Securing and implementing enterprise applications","featuredImage":"https://i.ibb.co/C2mp69m/disable-user-consent.png"},{"id":"V1en9Iugh","sectionId":"AFV_acckJ","slug":"Whats-a-conditional-access-policy-V1en9Iugh","title":"What's a conditional access policy?","featuredImage":"https://i.ibb.co/DQm1sY0/Create-conditional-access-policy.png"},{"id":"nAAIvNbtk","sectionId":"AFV_acckJ","slug":"The-many-ways-to-implement-multi-factor-authentication-MFA-in-Microsoft-365-nAAIvNbtk","title":"The many ways to implement multi-factor authentication (MFA) in Microsoft 365","featuredImage":"https://i.ibb.co/P1P0wNY/microsoft-365-manage-security-defaults.png"},{"id":"2S9jn0aLr","sectionId":"AFV_acckJ","slug":"Implement-Self-service-password-reset-in-Microsoft-365-2S9jn0aLr","title":"Implement Self-service password reset in Microsoft 365","featuredImage":"https://i.ibb.co/58y9JVg/write-back-passwords-to-on-premises-directory.png"},{"id":"FldNualGC","sectionId":"AFV_acckJ","slug":"Locking-down-your-Microsoft-365-tenant-from-Microsoft-engineers-FldNualGC","title":"Locking down your Microsoft 365 tenant from Microsoft engineers","featuredImage":"https://i.ibb.co/DCmpnT9/Enable-Customer-Lockbox.png"},{"id":"NFQ6rYFeQ","sectionId":"AFV_acckJ","slug":"Implementing-intelligent-security-using-risk-policies-in-Microsoft-365-NFQ6rYFeQ","title":"Implementing intelligent security using risk policies in Microsoft 365","featuredImage":"https://i.ibb.co/0cyQJ7j/Risk-Detections.png"},{"id":"rK48f6iM2","sectionId":"AFV_acckJ","slug":"Automating-Access-Review-in-Microsoft-365-rK48f6iM2","title":"Automating Access Review in Microsoft 365","featuredImage":"https://i.ibb.co/Xsxvz6Z/new-access-review.png"},{"id":"RHW1API2s","sectionId":"AFV_acckJ","slug":"Just-in-time-approval-and-notification-for-admin-roles-in-Microsoft-365-RHW1API2s","title":"Just in time, approval and notification for admin roles in Microsoft 365","featuredImage":"https://i.ibb.co/dcb6XFN/Activate-a-Role.png"},{"id":"z8EMM9Eu_","sectionId":"QScYfSu74","slug":"Whats-Microsoft-365-Defender-z8EMM9Eu_","title":"What's Microsoft 365 Defender?","featuredImage":"https://i.ibb.co/MDMyDQt/Microsoft-Defender.png"},{"id":"Kye_yNLxA","sectionId":"QScYfSu74","slug":"Whats-Microsoft-Defender-for-identity-Kye_yNLxA","title":"What's Microsoft Defender for identity?","featuredImage":"https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png"},{"id":"EnPyp7ukN","sectionId":"QScYfSu74","slug":"Whats-Microsoft-Defender-for-Office-365-EnPyp7ukN","title":"What's Microsoft Defender for Office 365?","featuredImage":"https://i.ibb.co/WcwKY2G/Microsoft-365-incidents-and-alerts.png"},{"id":"6HUOr7qbL","sectionId":"QScYfSu74","slug":"Protect-your-email-environment-from-malicious-actors-6HUOr7qbL","title":"Protect your email and Office environment from malicious actors","featuredImage":"https://i.ibb.co/Df0KQVp/Reports.png"},{"id":"GCOOUsSBT","sectionId":"QScYfSu74","slug":"Protecting-email-against-phishing-attacks-GCOOUsSBT","title":"Protecting email against phishing attacks","featuredImage":"https://i.ibb.co/GCjZHWg/edit-actions.png"},{"id":"GG4cMY8pK","sectionId":"QScYfSu74","slug":"Simulating-attacks-with-Microsoft-365-GG4cMY8pK","title":"Simulating attacks with Microsoft 365","featuredImage":"https://i.ibb.co/NyvnbMK/simulation-overview-view-users-circled.png"},{"id":"z0qPG6v4T","sectionId":"QScYfSu74","slug":"Protecting-Windows-10-and-other-devices-with-Microsoft-Defender-for-Endpoint-z0qPG6v4T","title":"Protecting Windows 10 and other devices with Microsoft Defender for Endpoint","featuredImage":"https://i.ibb.co/T47Xhyh/enable-endpoint-connections.png"},{"id":"LEyZMWBSt","sectionId":"QScYfSu74","slug":"Collect-detect-investigate-and-respond-to-security-threats-using-Microsoft-Sentinel-LEyZMWBSt","title":"Collect, detect, investigate, and respond to security threats using Microsoft Sentinel","featuredImage":"https://i.ibb.co/qN9XsKj/Add-Workbook.png"},{"id":"7MQ3wE4wP","sectionId":"QScYfSu74","slug":"Implement-and-manage-Microsoft-Defender-for-Cloud-Apps-7MQ3wE4wP","title":"Implement and manage Microsoft Defender for Cloud Apps","featuredImage":"https://i.ibb.co/7g7LvFg/office-365-cloud-apps-settings.png"},{"id":"sH_Ee1DW1","sectionId":"QScYfSu74","slug":"Auditing-sign-ins-and-other-actions-in-Microsoft-365-sH_Ee1DW1","title":"Auditing sign-ins and other actions in Microsoft 365","featuredImage":"https://i.ibb.co/BqMw3jZ/Start-recording-user-and-admin-activity.png"},{"id":"vLweLmxZf","sectionId":"YhftdGIRX","slug":"How-to-classify-data-using-labels-in-Microsoft-365-vLweLmxZf","title":"How to classify data using labels in Microsoft 365","featuredImage":"https://i.ibb.co/k9nhWS5/Choose-protection-settings-for-files-and-emails.png"},{"id":"NsF7No40f","sectionId":"YhftdGIRX","slug":"Creating-and-managing-data-retention-to-conform-to-compliance-NsF7No40f","title":"Creating and managing data retention to conform to compliance","featuredImage":"https://i.ibb.co/yqC0ZdY/New-Retention-Policy.png"},{"id":"IsPGsme8w","sectionId":"YhftdGIRX","slug":"Preventing-accidental-and-malicious-data-loss-with-DLP-policies-IsPGsme8w","title":"Preventing accidental and malicious data loss with DLP policies","featuredImage":"https://i.ibb.co/n8WcqKM/Create-a-DLP-policy.png"},{"id":"wv2PbXnhI","sectionId":"YhftdGIRX","slug":"Everything-you-need-to-know-about-securing-SharePoint-Online-for-the-MS-500-wv2PbXnhI","title":"Everything you need to know about securing SharePoint Online for the MS-500","featuredImage":"https://i.ibb.co/Gk9NjSH/Share-Point-Online-Warning.png"},{"id":"7gR3L122b","sectionId":"l0DxUuonW","slug":"Introduction-to-Intune-7gR3L122b","title":"Introduction to Intune","featuredImage":"https://i.ibb.co/Fq3N8BX/Endpoint-Manager-Admin-Center.png"},{"id":"ZyKX3Idjs","sectionId":"l0DxUuonW","slug":"Setting-up-Android-Devices-ZyKX3Idjs","title":"Setting up Android Devices","featuredImage":"https://i.ibb.co/m0BYhL2/Connect-Intune-to-Google-Play.png"},{"id":"MAjW0a2_p","sectionId":"l0DxUuonW","slug":"Setting-up-Apple--iOS-devices-in-Intune-MAjW0a2_p","title":"Setting up Apple / iOS devices in Intune","featuredImage":"https://i.ibb.co/X7Ffb2B/Setup-Apple-Enrollment-in-Intune.png"},{"id":"XFXu2zIS9","sectionId":"l0DxUuonW","slug":"Setting-up-Windows-10-devices-in-Intune-XFXu2zIS9","title":"Setting up Windows 10 devices in Intune","featuredImage":"https://i.ibb.co/WDXKVjW/configure-device-options.png"},{"id":"_LL9VqGZO","sectionId":"l0DxUuonW","slug":"How-to-manage-devices-using-Intune-_LL9VqGZO","title":"How to manage devices using Intune","featuredImage":"https://i.ibb.co/HPQ2m8t/Create-an-endpoint-protection-profile.png"},{"id":"qDRA4jjoN","sectionId":"l0DxUuonW","slug":"Understanding-compliance-policies-qDRA4jjoN","title":"Understanding compliance policies","featuredImage":"https://i.ibb.co/N3Qk57v/Create-a-compliance-policy.png"},{"id":"62t_7oiZx","sectionId":"l0DxUuonW","slug":"Restricting-and-managing-apps-on-user-devices-62t_7oiZx","title":"Restricting and managing apps on user devices","featuredImage":"https://i.ibb.co/PCVRKDf/Add-an-Android-app-to-Intune.png"}],
      articleHtml: `<p>Microsoft Defender for Identity is designed to protect your on-premises Active Directory (AD) and Active Directory Federation Services (ADFS). Microsoft Defender for Identity can perform the following:</p>
<ul>
<li>Monitor user and entity behavior/activities with intelligent analytics.</li>
<li>Protect user identities and reduces the attack surface.</li>
<li>Identify and investigate suspicious user activities to find advanced attacks throughout your environment.</li>
<li>Use the Microsoft 365 portal to monitor and respond to investigate alerts and user activity.</li>
</ul>
<h2>How does Microsoft Defender for Identity work?</h2>
<p>Microsoft Defender for Identity monitors your domain controllers' network traffic and event logs. It then uses this information to detect attacks and threats. Microsoft Defender for Identity gathers the information and analyzes it based on user and device behavior. But what's the flow?</p>
<p>In short, you install a sensor on your AD FS servers and domain controllers. The sensor will send the network traffic, Windows events, and traces back to Microsoft Defender for Identity that's in the Microsoft 365 cloud. Microsoft Defender for Identity will send the information to the Microsoft Defender for Cloud Apps portal and show you the activities, and alerts.</p>
<p><em>But don't worry. Microsoft won't use your data for advertising or anything else other than providing you the defense your organization needs.</em></p>
<h2>What licenses will give us Microsoft Defender for Identity?</h2>
<p>Microsoft Defender for Identity is part of the Enterprise Mobility + Security 5 (EMS E5) and as a standalone license.</p>
<h2>How do you set up Microsoft Defender for Identity?</h2>
<p>There are a couple of steps to set up the Microsoft Defender for Identity. In short, we'll need to configure Defender for Identity and then install the sensor on your AD servers. After that, we'll need to configure the account for automatic actions. Then we'll need to set up the sensitive accounts and honey token accounts. Next, we'll enable the integration between Defender for Identity and Defender for Cloud Apps, as well as, Defender for Endpoint. Then you'll need to review the reports and Secure Score to improve the security of your environment. Finally, you'll need to monitor the alerts.</p>
<h3>How to configure Microsoft Defender for Identity</h3>
<p>1. Go to the <strong>Microsoft 365 Defender portal</strong> &gt; <strong>More resources</strong> &gt; Click <a href="https://portal.atp.azure.com/" target="_blank"><strong>Open</strong></a> located under <strong>Azure Advanced Threat Protection</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/4FyCGbZ/Open-Defender-for-Identity.png" alt="How to open the Microsoft Defender for Identity Portal" style="height: auto;width: auto"/></div>
<p><div style="text-align:left;"><img src="https://i.ibb.co/zfjrs6K/Open-Defender-for-Identity.png" alt="How to open Microsoft Defender for Identity" style="height: auto;width: auto"/></div>2. If you receive the Welcome screen click <strong>Create</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/0jhdMwP/defender-for-identity-create.png" alt="Create the Defender for Identity instance" style="height: auto;width: auto"/></div>
<p>3. Click <strong>configuration</strong> &gt; <strong>Directory services</strong>.</p>
<p>4. Open <strong>PowerShell </strong>on your domain controller. Run the following script:</p>
<pre>Import-Module ActiveDirectory<br>if ((Get-KdsRootKey) -eq $null) {<br>     Add-KdsRootKey -EffectiveImmediately<br>     Write-Host "Please wait 10 hours and then run this script again"<br>} else {<br>     $DomainControllers = Get-ADDomainController<br>     $Dcs = @()<br>     foreach ($DomainController in $DomainControllers) {<br>          $Dcs += "$($DomainController.Name)$"<br>     }<br>     new-adserviceaccount -name gMSA01 -dnshostname ((Get-DnsServer).ServerSetting.ComputerName) -PrincipalsAllowedToRetrieveManagedPassword $Dcs<br>}</pre>
<p>5. If you receive the message "<strong>Please wait 10 hours and then run this script again</strong>" wait 10 hours then run the script again.</p>
<p>6. Enter the username of <strong>gMSA01</strong>. Click the <strong>Group managed service account</strong>. Enter your <strong>domain name</strong> in the space provided. Click <strong>Save</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/qsYwScq/Defender-for-Identity-Directory-Services.png" alt="Setup directory services with Defender for Identity" style="height: auto;width: auto"/></div>
<h3>How to<div style="text-align:left;"><img src="https://i.ibb.co/r4mpPNq/Microsoft-Defender-for-Identity-Setup.png" alt="Microsoft Defender for Identity creation" style="height: auto;width: auto"/></div>install the sensor on your AD servers</h3>
<p>1. Open the <a href="https://portal.atp.azure.com/" target="_blank">Microsoft Defender for Identity admin center</a>.</p>
<p>2. Click <strong>Configuration</strong> &gt; <strong>Sensors</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/w6TtrRt/defender-for-identity-download-sensors.png" alt="Microsoft Defender for identity sensors" style="height: auto;width: auto"/></div>
<p>3. Click <strong>Download</strong>. Save the zip to your computer.</p>
<p>4. Copy the zip file to one of your domain controllers.</p>
<p>5. Extract the zip.</p>
<p>6. Run <strong>Azure ATP Sensor Setup.exe</strong></p>
<p>7. On the Install Microsoft Defender for Identity Sensor page click <strong>Next</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/BBV6hs7/Microsoft-Defender-for-Identity-Sensor-Install-Choose-Language.png" alt="Microsoft Defender for Identity Sensor Install Choose Language" style="height: auto;width: auto"/></div>
<p>8. On the Sensor deployment type page click <strong>Next</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/xgVRBHc/Microsoft-Defender-for-Identity-Sensor-Install-Deployment-Type.png" alt="Microsoft Defender for Identity Sensor Install Deployment Type" style="height: auto;width: auto"/></div>
<p>9. Go back to the Defender for Identity admin center sensory web page and <strong>copy </strong>the Access key. <strong>Paste </strong>the access key into the Configure the Sensor page. Click <strong>Install</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/DzKrx0z/Microsoft-Defender-for-Identity-Sensor-Install-Configure-the-Sensor.png" alt="Microsoft Defender for Identity Sensor Install Configure the Sensor" style="height: auto;width: auto"/></div>
<p>10. Click Finish.</p>
<p>11. Repeat steps 4-10 on each domain controller.</p>
<p>12. Once the sensor is installed on all of your domain controllers refresh the Defender for Identity Sensors web page and verify the DCs appear in the list with the status of <strong>Running</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/FzXLp2J/defender-for-identity-DCs.png" alt="Defender for Identity DCs with Sensor installed" style="height: auto;width: auto"/></div>
<h3>Configure Delayed updates</h3>
<p>Now that we have the software installed there's one configuration option you should know. Delayed updates give you the ability to set the Defender for Identity to delay installing updates by 72 hours. Typically, Microsoft will release updates for the sensor a couple of times a month. By setting the delay to 72 hours you may be a little bit behind but you'll be less likely to have a negative impact due to an update being misconfigured.</p>
<p>1. <span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">Go to the <strong>Microsoft 365 Defender portal</strong> &gt; <strong>More resources</strong> &gt; Click </span><a href="https://portal.atp.azure.com/" target="_blank"><span style="color: rgb(13,110,253);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;"><strong><ins>Open</ins></strong></span></a><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;"> located under <strong>Azure Advanced Threat Protection</strong>.</span></p>
<p><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">2. Click <strong>Settings </strong>in the left nav &gt; <strong>Updates</strong>. Click the Delayed update switch to <strong>On</strong>. Click <strong>Save</strong>.</span></p>
<div style="text-align:none;"><img src="https://i.ibb.co/KhQT36Y/delay-updates.png" alt="Microsoft Defender for Identity Delayed updated" style="height: auto;width: auto"/></div>
<h2>Configure Automatic Actions</h2>
<p>In these steps, we'll set up the group account we created earlier to perform automatic actions in our AD domain.</p>
<p>1. Open <strong>Active Directory Users and Computers</strong>. Right-click the <strong>domain </strong>and click <strong>Properties</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/F5dcMLV/AD-Properties.png" alt="Open domain properties" style="height: auto;width: auto"/></div>
<p>2. Click the <strong>Security </strong>tab &gt; <strong>Advanced </strong>&gt; <strong>Add</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/375P8GM/Add-Advanced-Permissions.png" alt="Add advanced permissions" style="height: auto;width: auto"/></div>
<p>3. Click <strong>Select a principal</strong>. Click <strong>Object Types</strong> &gt; <strong>Service Accounts</strong> &gt; <strong>OK</strong>. Enter <strong>gMSA01</strong> in the object name to select box. Click <strong>OK</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/MkCvDqj/select-a-principal.png" alt="Select a principal" style="height: auto;width: auto"/></div>
<p>4. Click the <strong>Applies to</strong> drop down. Select <strong>Descendant User object</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/7jsFRLc/Applies-to.png" alt="Applies to" style="height: auto;width: auto"/></div>
<p>5. To enable force password reset click <strong>Permissions: Reset password</strong>. Then click <strong>Properties: Read pwdLastSet</strong> &amp; <strong>Properties: Write pwdLastSet</strong></p>
<p>6. To grant the account the ability to disable users click <strong>Properties: Read userAccountControl</strong> &amp; <strong>Properties: Write userAccountControl</strong></p>
<div style="text-align:none;"><img src="https://i.ibb.co/vvjdwDy/User-Permissions.png" alt="User Permissions" style="height: auto;width: auto"/></div>
<p>8. Click <strong>OK</strong>.</p>
<p>7. Click <strong>Add</strong> &gt; <strong>Select a principal</strong>. Enter <strong>GMSA01</strong> in the name field again and click <strong>OK</strong>. Click the <strong>Applies to</strong> dropdown. Then click <strong>Descendant Group objects</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/YbPw0Zc/group-objects.png" alt="Group objects" style="height: auto;width: auto"/></div>
<p>8. Click <strong>Properties: Read Members</strong> &amp; <strong>Properties: Write Members</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/T2bgwNJ/group-permissions.png" alt="Group permissions" style="height: auto;width: auto"/></div>
<p>9. Click <strong>OK</strong>. Click <strong>Apply </strong>&gt; <strong>OK</strong>.</p>
<p>10. Go back to the Microsoft Defender admin center web page again. Click Settings &gt; Identities &gt; <a href="https://security.microsoft.com/settings/identities?tabid=manageAccounts" target="_blank">Manage action accounts</a>.&nbsp;</p>
<p>11. Click <strong>Add credentials</strong>. Set the account name to <strong>gMSA01</strong>. Set the domain to your <strong>internal domain name</strong>. Click <strong>Save</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/8sSxWZV/add-credentials-for-action-accounts.png" alt="Add credentials for action accounts" style="height: auto;width: auto"/></div>
<h3>How to set up the sensitive accounts</h3>
<p>Sensitive accounts are typically C-level executives and administrator accounts. Administrator accounts and domain controllers are automatically added as sensitive accounts but we'll add them manually anyway. These accounts will require extra alerts and management by Defender for Identity.</p>
<p>1. Go to <strong>Microsoft Defender admin center</strong> &gt; <strong>Settings </strong>&gt; <strong>Identitites</strong> &gt; <a href="https://security.microsoft.com/settings/identities?tabid=entityTagsSensitive" target="_blank"><strong>Sensitive</strong></a>.</p>
<p>2. Click <strong>Tag users</strong>. Click the check box next to the <strong>accounts you want to add</strong>. Click <strong>Add selection</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/9nC0B4Z/tag-sensitive-accounts.png" alt="Tag sensitive accounts" style="height: auto;width: auto"/></div>
<h3>How to set up honey token accounts</h3>
<p>Honey token accounts are accounts that are never used. They should never be logged into by anyone. When a malicious user accesses your environment and then uses that account in an attempt to gain elevated permissions then Defender for Identity will trigger alerts.</p>
<p>1. Create an account in your on-premises Active Directory Users and Computers. Name the account something like "Gruber Admin" that a malicious user would find and attempt to access.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/s58V9jq/honeytoken-account-creation.png" alt="Honeytoken account creation" style="height: auto;width: auto"/></div>
<p><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">2. Wait until your on-premises AD syncs to Microsoft 365. Typically it takes about 1 hour.</span></p>
<p><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">3. Go to <strong>Microsoft Defender admin center</strong> &gt; <strong>Settings </strong>&gt; <strong>Identities</strong> &gt; </span><a href="https://security.microsoft.com/settings/identities?tabid=entityTagsHoneytoken" target="_blank"><span style="color: rgb(13,110,253);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;"><strong><ins>Honeytoken</ins></strong></span></a><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">.</span></p>
<p><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">4. Click <strong>Tag users</strong>. <strong>Select the honeytoken account</strong> you created in step 1. Click <strong>Add selection</strong>.</span></p>
<div style="text-align:none;"><img src="https://i.ibb.co/3cFcT2J/honeytoken-account-setup.png" alt="Honeytoken account setup" style="height: auto;width: auto"/></div>
<h3>Enable Microsoft Defender for Identity data integration into Microsoft Defender for Cloud Apps</h3>
<p>1. Open Microsoft Defender portal &gt; More resources &gt; <a href="https://go.microsoft.com/fwlink/?linkid=2058038" target="_blank">Microsoft Defender for Cloud Apps</a>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/ZXQX5Rd/Open-Microsoft-Defender-for-Cloud-Apps.png" alt="Open Microsoft Defender for Cloud Apps" style="height: auto;width: auto"/></div>
<p>2. Click the <strong>gear </strong>in the top right corner &gt; <strong>Settings </strong>&gt; <strong>Microsoft Defender for Identity</strong>. Check the <strong>Enable Microsoft Defender for Identity integration</strong>. Click <strong>Save</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/f0NNnnb/Defender-for-Cloud-Apps-integration-with-Defender-for-Identity.png" alt="Integrate Defender for Cloud Apps with Defender for Identity" style="height: auto;width: auto"/></div>
<h2>Enable Microsoft Defender for Identity data integration into Microsoft Defender for Endpoint</h2>
<p><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">1. Go to Microsoft Defender for Identity admin center &gt; Configuration &gt; </span><a href="https://portal.atp.azure.com/configuration?tab=wdatp" target="_blank"><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">Microsoft Defender for Endpoint</span></a><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">.</span></p>
<p><span style="color: rgb(33,37,41);background-color: rgb(255,255,255);font-size: 16px;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji;">2. Click On next to <strong>Integration with Microsoft Defender for Endpoint</strong>. Click <strong>Save</strong>.</span></p>
<div style="text-align:none;"><img src="https://i.ibb.co/qW4W1SS/Enable-Integration-Between-Defender-for-Endpoint-and-Defender-for-Identity.png" alt="Enable Integration Between Defender for Endpoint and Defender for Identity" style="height: auto;width: auto"/></div>
<p>3. Go to the <strong>Microsoft 365 Defender admin center</strong> &gt; <strong>Settings</strong> &gt; <strong>Endpoints </strong>&gt; <a href="https://security.microsoft.com/preferences2/integration" target="_blank"><strong>Advanced Features</strong></a>.</p>
<p>4. Enable the <strong>Microsoft Defender for Identity integration</strong> setting. Click <strong>Save preferences</strong>.</p>
<div style="text-align:none;"><img src="https://i.ibb.co/WkvGhbd/Enable-Defender-for-Identity-and-endpoint-integration.png" alt="Enable Defender for Identity and endpoint integration" style="height: auto;width: auto"/></div>
<h2>How to configure monitoring for a server that cannot connect to the internet</h2>
<p>Let's say you have two servers: Server1 and Server2. Server1 is a domain controller and can connect to the internet. Server2 is a member server and can't connect to the internet. How do we monitor Server2 using Microsoft Defender for Identity? With an event subscription and port mirroring!</p>
<h3>Install the sensor in standalone mode</h3>
<p>Here's another scenario you'll probably never see in real life but it may be on the test. Let's say you have 2 servers: server1 and server2. Server1 is a domain controller and can't connect to the internet. Server2 is a member server and can communicate with server1 and connect to the internet. How do you monitor server2 using the sensor?</p>
<p>1. Install the standalone sensor on Server2</p>
<p>2. Setup event subscription on Server2</p>
<p>3. Setup <a href="https://docs.microsoft.com/en-us/defender-for-identity/configure-port-mirroring" target="_blank">port mirroring</a> on Server1</p>
<h2>How to monitor VPN</h2>
<p>So now we're at another oddball. It's not very common so I won't go into details but you may see the question on the test. How do we integrate a VPN and Microsoft Defender for Identity?</p>
<p>Let's run through the scenario. Let's say you have a VPN server named VPN1 that runs Windows Server 2016 with the Remote Access role installed and configured. You have the Defender for Identity sensor installed on a Windows Server 2016 server named Server1. How do we integrate the VPN and Defender for Identity?</p>
<p>1. Configure <a href="https://docs.microsoft.com/en-us/defender-for-identity/install-step6-vpn#configure-radius-accounting-on-the-vpn-system" target="_blank">RADIUS Accounting</a> on VPN1</p>
<p>2. Enable <a href="https://docs.microsoft.com/en-us/defender-for-identity/install-step6-vpn#configure-vpn-in-defender-for-identity" target="_blank">VPN / RADIUS Accounts</a> in Defender for Identity</p>
<p>3. Enable <a href="https://docs.microsoft.com/en-us/defender-for-identity/install-step6-vpn#configure-vpn-in-defender-for-identity" target="_blank">inbound port 1813</a> on Server1</p>
<h2>How to integrate SIEM and Defender for identity</h2>
<p>Here's another oddball I won't go into detail but you may see it on the test. How and when do we integrate a third-party security information and event management (SIEM) solution and Defender for Identity?</p>
<p>You'll need to integrate a SIEM and Defender for Identity when you're using a third-party SIEM solution and you want Defender for Identity to detect when sensitive groups are modified and when malicious services are created. In short, anytime you want Defender for Identity to alert when the SIEM solution picks up an issue.</p>
<p>How do you integrate a SIEM solution and Defender for Identity? By configuring event forwarding on the domain controllers / SIEM solution.</p>
<h2>How to monitor alerts</h2>
<p>The alerts will show up in a couple of different places. First, they'll show up in the Microsoft Defender for Identity Timeline. Next, they'll show up in the Microsoft Defender admin center Alerts &amp; Investigation pages. Finally, they'll show up on the Microsoft Defender for Cloud Apps Alerts page.</p>
<h3>How to view alerts in the Microsoft Defender for Identity Timeline</h3>
<div style="text-align:none;"><img src="https://i.ibb.co/bQDBh0Y/Defender-for-Identity-Timeline.png" alt="Defender for Identity timeline" style="height: auto;width: auto"/></div>
<p>1. Go to <strong>Microsoft Defender for Identity admin center</strong> &gt; <a href="https://portal.atp.azure.com/timeline?status=Open&severity=All" target="_blank"><strong>Timeline</strong></a>.</p>
<p>From there you'll see the suspicious activity in a timeline. You can click an alert to review more details about the issue. You can also click the ellipsis (...) next to an alert and close, suppress, or delete an alert.</p>
<h3>How to view alerts in the Microsoft Defender admin center</h3>
<div style="text-align:none;"><img src="https://i.ibb.co/G9qzFPn/Honeytoken-breach-in-microsoft-defender.png" alt="Honeytoken breach in Microsoft defender admin center" style="height: auto;width: auto"/></div>
<p>1. Open the <strong>Microsoft Defender admin center</strong> &gt; <strong>Incidents &amp; alerts</strong> &gt; <strong>Incidents</strong>.</p>
<p>From there you can see the incidents. By clicking an incident name you can view more information, for example, the user and device that was used.</p>
<h3>How to view alerts in the Microsoft Defender for Cloud Apps admin center</h3>
<div style="text-align:none;"><img src="https://i.ibb.co/nbDKcWs/Defender-for-Cloud-Apps-Alerts.png" alt="Defender for Cloud Apps alerts" style="height: auto;width: auto"/></div>
<p>1. Open the <strong>Microsoft Defender for Cloud Apps admin center</strong> &gt; <strong>Alerts</strong>.</p>
`,
      nextContentSlug: 'Whats-Microsoft-Defender-for-Office-365-EnPyp7ukN',
      previousContentSlug: 'Whats-Microsoft-365-Defender-z8EMM9Eu_',
      hasCompletedContent: false,
      userAcct: {completedContent: []}
    }
  }

  componentDidMount() {
    this.onAuthStateChangedListener = onAuthStateChanged((user) => {
      if (user) {
        getDoc('courses/MS-500/users', user.uid).then((userAcct) => {
          if (!userAcct.completedContent) {
            userAcct.completedContent = []
          }
          this.setState({userAcct})
        })
      }
    })

    if (isBrowser()) {
      document.addEventListener('scroll', this.trackScrolling)
      this.setState({isTrackScrolling: true})
    }

    if (this.state.course.COURSE) {
      getDoc('courses', 'MS-500').then((course) => {
        this.setState({course})

        if (this.state.articles[0] === 'ARTICLES') {
          getAllDocs('courses/MS-500/contents').then((articles) => {
            const contentSorted = sort(course, articles)
            this.setState({ articles: contentSorted })

            if (this.state.article.ARTICLE) {
              getDoc('courses/MS-500/contents', '2QfoI2HxY').then((article) => {
                const articleHtml = draftToHtml(article.article)

                const idx = course.contentOrder.indexOf(article.id)

                const nextContentSlug = idx < articles.length - 1 ? contentSorted[idx + 1].slug : this.state.nextContentSlug
                const previousContentSlug = idx > 0 ? contentSorted[idx - 1].slug : this.state.previousContentSlug

                this.setState({article, articleHtml, nextContentSlug, previousContentSlug})
              })
            }
          })
        }
      })
    }
  }

  componentWillUnmount() {
    if (isBrowser() && this.state.isTrackScrolling)
      document.removeEventListener('scroll', this.trackScrolling);

    this.onAuthStateChangedListener()
  }

  trackScrolling() {
    if (document.body.scrollHeight * .8 < window.innerHeight + window.scrollY) {
      this.setHasCompletedContent(true)
    }
  }

  setHasCompletedContent(val) {
    if (val === true) {
      document.removeEventListener('scroll', this.trackScrolling);
      this.setState({isTrackScrolling: false})

      if (this.state.userAcct.id) {
        const userAcct = this.state.userAcct

        if (!userAcct.completedContent.includes(this.state.article.id)) {
          userAcct.completedContent.push(this.state.article.id)
          this.setState({userAcct})
          saveDoc('courses/MS-500/users', userAcct)
        }
      }
    }
  }

  render() {
    const jsonLd = {
      headline: this.state.article.title,
      datePublished: this.state.article.datePublished,
      keywords: [
        "Microsoft",
        "Microsoft 365",
        "Office 365",
        'MS-500',
        'Microsoft 365 Security Administration'
      ],
      "author": {
        "@type": "Person",
        "name": "John Gruber",
        url: 'https://medium.com/@gruberjl'
      }
    }

    return (
      <Page jsonLdType={'BlogPosting'} jsonLd={jsonLd} image={this.state.article.featuredImage} canonical={this.props.location.href} title={this.state.article.title} description={this.state.article.description}>
        <main>
          <Container fluid>
            <Row>
              <Col lg={9}>
                <Container>
                  <h1 style={marginTop24Style}>{this.state.article.title}</h1>
                  <div dangerouslySetInnerHTML={{__html: this.state.articleHtml}} className='img-width-100 article'></div>
                  <div className='flex-space-between margin12'>
                    <Link to={ this.state.previousContentSlug === 'PREVIOUS_CONTENT' ? '/' : `/course/ms-500/learn/${this.state.previousContentSlug}` }><IoChevronBack /> Previous</Link>
                    <Link to={ this.state.nextContentSlug === 'NEXT_CONTENT' ? '/' : `/course/ms-500/learn/${this.state.nextContentSlug}` }>Next <IoChevronForward /></Link>
                  </div>
                </Container>
              </Col>
              <Col lg={3}>
                <Accordion defaultActiveKey="0">
                  {this.state.course.sections.map((section, idx) => (
                    <Accordion.Item eventKey={idx} key={idx}>
                      <Accordion.Header>{section.title}</Accordion.Header>
                      <Accordion.Body style={removePaddingStyle}>
                        <ListGroup defaultActiveKey={`/course/ms-500/learn/${this.state.currentSlug}`} variant="flush">
                          { this.state.articles.filter(article => article.sectionId === section.id).map((article, articleIdx) => (
                            <ListGroup.Item style={listItemStyle} action to={`/course/ms-500/learn/${article.slug}`} href={`/course/ms-500/learn/${article.slug}`} as={Link} key={articleIdx} className='navigation-item'>
                              <Form.Check label={article.title} checked={this.state.userAcct.completedContent.includes(article.id)} onChange={() => {}} />
                            </ListGroup.Item>
                          ))}
                        </ListGroup>
                      </Accordion.Body>
                    </Accordion.Item>
                  ))}
                </Accordion>
              </Col>
            </Row>
          </Container>
        </main>
      </Page>
    )
  }
}

export default ArticlePage
